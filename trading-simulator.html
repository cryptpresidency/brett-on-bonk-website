<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Brett Trading Bot Simulator | Brett on Bonk</title>
  <meta name="description" content="Practice trading BRETT tokens with virtual money. Compete on the leaderboard and become the best Brett trader!">
  <link rel="canonical" href="https://brettonbonk.com/trading-simulator">
  <meta property="og:title" content="Brett Trading Bot Simulator | Brett on Bonk">
  <meta property="og:description" content="Practice trading BRETT tokens with virtual money. Compete on the leaderboard and become the best Brett trader!">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://brettonbonk.com/trading-simulator">
  <meta property="og:image" content="https://brettonbonk.com/assets/brett%20head.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Brett Trading Bot Simulator | Brett on Bonk">
  <meta name="twitter:description" content="Practice trading BRETT tokens with virtual money. Compete on the leaderboard and become the best Brett trader!">
  <meta name="twitter:image" content="https://brettonbonk.com/assets/brett%20head.png">
  <link rel="icon" type="image/png" href="assets/brett%20head.png">
  <link rel="stylesheet" href="style.css">
  <link rel="preload" href="assets/brett%20font.ttf" as="font" type="font/ttf" crossorigin>
  <style>
    /* --- Trading Simulator Layout & Overlap Fixes --- */

    .main-content-area {
      margin-top: 80px;
      padding-bottom: 2rem;
      max-width: 100vw;
      box-sizing: border-box;
      overflow-x: hidden;
    }

    .section-panel {
      margin-bottom: 2rem;
      box-sizing: border-box;
      max-width: 100vw;
      width: 100%;
    }

    .price-chart, .analytics-grid {
      overflow-x: auto;
      max-width: 100vw;
    }

    button, input, select, textarea {
      min-height: 44px;
      min-width: 44px;
      box-sizing: border-box;
    }

    @media (max-width: 768px) {
      .main-content-area {
        padding: 0.5rem;
        margin-top: 70px;
      }
      .section-panel {
        margin-bottom: 1rem;
        padding: 0.5rem;
        font-size: 0.95em;
      }
      .price-chart, .analytics-grid {
        padding: 0.2rem;
      }
    }

    .tips-modal, .whale-announcement, .event-modal {
      z-index: 4000 !important;
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }

    /* Remove any fixed heights that could cause overflow or overlap */
    .trading-container, .main-content-area, .section-panel {
      height: auto !important;
      min-height: unset !important;
    }

    .trading-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem;
      padding-top: 2rem; /* Extra padding for top options bar */
      background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      min-height: 100vh;
    }

    .trading-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding: 1rem;
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 15px;
    }

    .trading-title {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 2.5rem;
      text-shadow: 3px 3px 0px #000;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 2px solid #FFD300;
    }

    .user-details {
      text-align: right;
    }

    .username {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1.2rem;
      margin-bottom: 0.2rem;
    }

    .user-balance {
      color: #fff;
      font-size: 1rem;
    }

    .user-stats {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
      font-size: 0.8rem;
    }

    .stat-item {
      background: rgba(255, 211, 0, 0.2);
      padding: 0.2rem 0.5rem;
      border-radius: 5px;
      border: 1px solid #FFD300;
    }

    .stat-label {
      color: #FFD300;
      font-weight: bold;
    }

    .stat-value {
      color: #fff;
    }

    .analytics-panel {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .analytics-title {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .analytics-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
    }

    .analytics-value {
      color: #FFD300;
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .analytics-label {
      color: #fff;
      font-size: 0.9rem;
    }

    .mini-game-panel {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .prediction-game {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .prediction-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin: 1rem 0;
    }

    .prediction-btn {
      background: #FFD300;
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 0.8rem 1.5rem;
      font-family: 'Bangers', cursive;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .prediction-btn:hover {
      background: #FF6B35;
      transform: scale(1.05);
    }

    .prediction-btn.correct {
      background: #4CAF50;
      color: #fff;
    }

    .prediction-btn.incorrect {
      background: #f44336;
      color: #fff;
    }



    .whale-medal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #FFD700, #FFA500);
      border: 3px solid #000;
      border-radius: 50%;
      width: 120px;
      height: 120px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 3rem;
      z-index: 3000;
      animation: whaleFloat 3s ease-in-out infinite;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
    }

    @keyframes whaleFloat {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.1); }
    }

    .whale-announcement {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
      padding: 1rem 2rem;
      border-radius: 15px;
      font-family: 'Bangers', cursive;
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      z-index: 3000;
      animation: whaleAnnounce 4s ease-in-out;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
      border: 3px solid #000;
    }

    @keyframes whaleAnnounce {
      0% { opacity: 0; transform: translateX(-50%) scale(0.5); }
      20% { opacity: 1; transform: translateX(-50%) scale(1.1); }
      80% { opacity: 1; transform: translateX(-50%) scale(1); }
      100% { opacity: 0; transform: translateX(-50%) scale(0.8); }
    }

    .whale-status {
      background: linear-gradient(45deg, #FFD700, #FFA500);
      color: #000;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      margin-left: 0.5rem;
      border: 2px solid #000;
      animation: whaleGlow 2s ease-in-out infinite;
    }

    @keyframes whaleGlow {
      0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
      50% { box-shadow: 0 0 20px rgba(255, 215, 0, 1); }
    }
    
    .post-to-x-btn {
      background: linear-gradient(45deg, #1DA1F2, #0D8BD9);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 25px;
      font-family: 'Bangers', cursive;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      margin-top: 1rem;
      box-shadow: 0 4px 15px rgba(29, 161, 242, 0.4);
      transition: all 0.3s ease;
      text-shadow: 2px 2px 0px #000;
    }
    
    .post-to-x-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(29, 161, 242, 0.6);
      background: linear-gradient(45deg, #0D8BD9, #1DA1F2);
    }
    
    .post-to-x-btn:active {
      transform: translateY(0);
    }
    
    .permanent-x-btn {
      background: linear-gradient(45deg, #1DA1F2, #0D8BD9);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 15px;
      font-family: 'Bangers', cursive;
      font-size: 0.9rem;
      font-weight: bold;
      cursor: pointer;
      margin-left: 0.5rem;
      box-shadow: 0 2px 8px rgba(29, 161, 242, 0.4);
      transition: all 0.3s ease;
      text-shadow: 1px 1px 0px #000;
    }
    
    .permanent-x-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(29, 161, 242, 0.6);
      background: linear-gradient(45deg, #0D8BD9, #1DA1F2);
    }
    
    .x-post-success {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      padding: 2rem;
      border-radius: 15px;
      font-family: 'Bangers', cursive;
      font-size: 1.5rem;
      text-align: center;
      z-index: 10000;
      box-shadow: 0 8px 25px rgba(76, 175, 80, 0.5);
      animation: xPostSuccess 0.5s ease-out;
    }
    
    @keyframes xPostSuccess {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
      }
      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }
    
    /* Intro Overlay Styles */
    .intro-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      overflow-y: auto;
    }
    
    .intro-content {
      background: rgba(255, 211, 0, 0.1);
      border: 3px solid #FFD300;
      border-radius: 20px;
      padding: 3rem;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(255, 211, 0, 0.3);
    }
    
    .intro-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .intro-brett-img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid #FFD300;
      margin-bottom: 1rem;
    }
    
    .intro-title {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 2.5rem;
      text-shadow: 3px 3px 0px #000;
      margin: 0;
    }
    
    .intro-body {
      margin-bottom: 2rem;
    }
    
    .intro-section {
      margin-bottom: 2rem;
    }
    
    .intro-section h2 {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1.8rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 0px #000;
    }
    
    .intro-section h3 {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1.4rem;
      margin-bottom: 0.8rem;
      text-shadow: 1px 1px 0px #000;
    }
    
    .intro-section p {
      color: #fff;
      font-size: 1.1rem;
      line-height: 1.6;
      margin-bottom: 1rem;
    }
    
    .intro-section ul {
      color: #fff;
      font-size: 1rem;
      line-height: 1.8;
      padding-left: 1.5rem;
    }
    
    .intro-section li {
      margin-bottom: 0.5rem;
    }
    
    .intro-section strong {
      color: #FFD300;
    }
    
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .feature-item {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .feature-item:hover {
      background: rgba(255, 211, 0, 0.2);
      transform: translateY(-2px);
    }
    
    .feature-icon {
      display: block;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    
    .feature-text {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1rem;
      font-weight: bold;
    }
    
    .intro-footer {
      text-align: center;
      border-top: 2px solid #FFD300;
      padding-top: 2rem;
    }
    
    .start-trading-btn {
      background: linear-gradient(45deg, #FFD300, #FFA500);
      color: #000;
      border: none;
      padding: 1.5rem 3rem;
      border-radius: 50px;
      font-family: 'Bangers', cursive;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 1rem;
      box-shadow: 0 6px 20px rgba(255, 211, 0, 0.4);
      transition: all 0.3s ease;
      text-shadow: 1px 1px 0px #fff;
    }
    
    .start-trading-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(255, 211, 0, 0.6);
      background: linear-gradient(45deg, #FFA500, #FFD300);
    }
    
    .start-trading-btn:active {
      transform: translateY(-1px);
    }
    
    .intro-note {
      color: #fff;
      font-size: 1rem;
      margin: 0;
      opacity: 0.8;
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
      .intro-overlay {
        padding: 1rem;
        align-items: flex-start;
      }
      
      .intro-content {
        padding: 1.5rem;
        margin: 0.5rem;
        max-height: 95vh;
      }
      
      .intro-title {
        font-size: 1.8rem;
      }
      
      .intro-section h2 {
        font-size: 1.3rem;
      }
      
      .intro-section h3 {
        font-size: 1.1rem;
      }
      
      .intro-section p {
        font-size: 1rem;
      }
      
      .intro-section ul {
        font-size: 0.9rem;
      }
      
      .feature-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.8rem;
      }
      
      .feature-item {
        padding: 0.8rem;
      }
      
      .feature-icon {
        font-size: 1.5rem;
      }
      
      .feature-text {
        font-size: 0.9rem;
      }
      
      .start-trading-btn {
        padding: 1rem 2rem;
        font-size: 1.2rem;
      }
      
      .intro-note {
        font-size: 0.9rem;
      }
    }
    
    @media (max-width: 480px) {
      .intro-content {
        padding: 1rem;
        margin: 0.25rem;
      }
      
      .intro-title {
        font-size: 1.5rem;
      }
      
      .intro-section h2 {
        font-size: 1.2rem;
      }
      
      .intro-section h3 {
        font-size: 1rem;
      }
      
      .feature-grid {
        grid-template-columns: 1fr;
      }
      
      .start-trading-btn {
        padding: 0.8rem 1.5rem;
        font-size: 1.1rem;
      }
    }

    .logout-btn {
      padding: 0.5rem 1rem;
      border: 2px solid #FFD300;
      border-radius: 8px;
      background: transparent;
      color: #FFD300;
      font-family: 'Bangers', cursive;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      background: #FFD300;
      color: #000;
    }

    .trading-workspace {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .chart-container {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .chart-title {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }

    .price-chart {
      width: 100%;
      height: 300px;
      background: #1a1a1a;
      border-radius: 10px;
      position: relative;
      overflow: hidden;
    }

    .candlestick {
      position: absolute;
      width: 8px;
      background: #4CAF50;
      border-radius: 2px;
      transition: all 0.3s ease;
    }

    .candlestick.red {
      background: #f44336;
    }

    .candlestick.wick {
      width: 2px;
      background: #888;
    }

    .news-feed {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .news-title {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }

    .news-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid #FFD300;
      transition: all 0.3s ease;
    }

    .news-item.bullish {
      border-left-color: #4CAF50;
      background: rgba(76, 175, 80, 0.1);
    }

    .news-item.bearish {
      border-left-color: #f44336;
      background: rgba(244, 67, 54, 0.1);
    }

    .news-time {
      color: #888;
      font-size: 0.8rem;
      margin-bottom: 0.5rem;
    }

    .news-text {
      color: #fff;
      font-size: 1rem;
      line-height: 1.4;
    }

    .tips-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .tips-content {
      background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      border: 3px solid #FFD300;
      border-radius: 20px;
      padding: 3rem;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .close-tips {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: #FFD300;
      color: #000;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1.5rem;
      cursor: pointer;
      font-weight: bold;
    }

    .tips-title {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 2rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .tip-item {
      background: rgba(255, 211, 0, 0.1);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid #FFD300;
    }

    .tip-title {
      color: #FFD300;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .tip-text {
      color: #fff;
      line-height: 1.4;
    }

    .date-display {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255, 211, 0, 0.9);
      color: #000;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      font-family: 'Bangers', cursive;
      font-size: 1.2rem;
      z-index: 100;
      border: 2px solid #000;
    }

    .fast-forward-container {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .fast-forward-btn {
      background: linear-gradient(45deg, #FFD300, #FF6B35);
      color: #000;
      border: none;
      border-radius: 12px;
      padding: 0.5rem 1rem;
      font-family: 'Bangers', cursive;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255, 211, 0, 0.3);
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .fast-forward-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(255, 211, 0, 0.5);
    }

    .fast-forward-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .fast-forward-btn.week {
      background: linear-gradient(45deg, #4CAF50, #45a049);
    }

    .fast-forward-btn.month {
      background: linear-gradient(45deg, #FF9800, #F57C00);
    }

    .fast-forward-btn.epic {
      background: linear-gradient(45deg, #E91E63, #C2185B);
    }

    .event-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .event-content {
      background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      border: 3px solid #FFD300;
      border-radius: 20px;
      padding: 3rem;
      max-width: 500px;
      text-align: center;
      position: relative;
      animation: eventPulse 2s infinite;
    }

    @keyframes eventPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .event-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .event-title {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .event-description {
      color: #fff;
      font-size: 1.2rem;
      line-height: 1.4;
      margin-bottom: 2rem;
    }

    .event-impact {
      background: rgba(255, 211, 0, 0.2);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 2rem;
    }

    .event-impact.bullish {
      background: rgba(76, 175, 80, 0.2);
      border: 2px solid #4CAF50;
    }

    .event-impact.bearish {
      background: rgba(244, 67, 54, 0.2);
      border: 2px solid #f44336;
    }

    .continue-btn {
      background: #FFD300;
      color: #000;
      border: none;
      border-radius: 10px;
      padding: 1rem 2rem;
      font-family: 'Bangers', cursive;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .continue-btn:hover {
      background: #FF6B35;
      transform: scale(1.05);
    }

    .price-crash {
      animation: crashShake 0.5s infinite;
    }

    .price-moon {
      animation: moonGlow 0.5s infinite;
    }

    @keyframes crashShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    @keyframes moonGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 211, 0, 0.5); }
      50% { box-shadow: 0 0 40px rgba(255, 211, 0, 1); }
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
      .fast-forward-container {
        top: 10px;
        gap: 0.3rem;
      }
      
      .fast-forward-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
      }
      
      .date-display {
        top: 10px;
        left: 10px;
        font-size: 1rem;
        padding: 0.3rem 0.8rem;
      }
      
      .tips-btn {
        top: 10px;
        right: 10px;
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
      }
      
      .sound-toggle {
        bottom: 10px;
        right: 10px;
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
      }
      
      .analytics-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .prediction-buttons {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .prediction-btn {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
      }
    }
    }

    .trading-panel {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 15px;
      padding: 2rem;
    }

    .panel-title {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      text-shadow: 2px 2px 0px #000;
    }

    .price-display {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #FFD300;
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      text-align: center;
    }

    .current-price {
      font-size: 3rem;
      color: #FFD300;
      font-family: 'Bangers', cursive;
      margin-bottom: 0.5rem;
    }

    .price-change {
      font-size: 1.2rem;
      font-weight: bold;
    }

    .price-change.positive {
      color: #4CAF50;
    }

    .price-change.negative {
      color: #f44336;
    }

    .trading-form {
      display: grid;
      gap: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .form-input {
      padding: 1rem;
      border: 2px solid #FFD300;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      font-family: 'Bangers', cursive;
      font-size: 1rem;
    }

    .form-input:focus {
      outline: none;
      border-color: #fff;
      box-shadow: 0 0 15px rgba(255, 211, 0, 0.5);
    }

    .trading-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    .trade-btn {
      padding: 1rem;
      border: none;
      border-radius: 10px;
      font-family: 'Bangers', cursive;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
    }

    .buy-btn {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: #fff;
    }

    .sell-btn {
      background: linear-gradient(45deg, #f44336, #d32f2f);
      color: #fff;
    }

    .trade-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .portfolio-panel {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 15px;
      padding: 2rem;
    }

    .portfolio-summary {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .portfolio-item {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #FFD300;
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
    }

    .portfolio-label {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .portfolio-value {
      color: #fff;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .trades-history {
      max-height: 300px;
      overflow-y: auto;
    }

    .trade-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }

    .trade-type {
      font-weight: bold;
      font-family: 'Bangers', cursive;
    }

    .trade-type.buy {
      color: #4CAF50;
    }

    .trade-type.sell {
      color: #f44336;
    }

    .trade-details {
      color: #fff;
      font-size: 0.9rem;
    }

    .trade-profit {
      font-weight: bold;
    }

    .trade-profit.positive {
      color: #4CAF50;
    }

    .trade-profit.negative {
      color: #f44336;
    }

    .leaderboard-section {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 15px;
      padding: 2rem;
      margin-top: 2rem;
    }

    .leaderboard-title {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 2rem;
      margin-bottom: 1.5rem;
      text-align: center;
      text-shadow: 2px 2px 0px #000;
    }

    .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
    }

    .leaderboard-table th,
    .leaderboard-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid rgba(255, 211, 0, 0.3);
    }

    .leaderboard-table th {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1.1rem;
    }

    .leaderboard-table td {
      color: #fff;
    }

    .leaderboard-user {
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .leaderboard-avatar {
      width: 30px;
      height: 30px;
      border-radius: 50%;
    }

    .current-user-row {
      background: rgba(255, 211, 0, 0.2);
      border: 2px solid #FFD300;
    }

    .achievements-section {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 15px;
      padding: 2rem;
      margin-top: 2rem;
    }

    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .achievement-item {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #FFD300;
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .achievement-item.unlocked {
      border-color: #4CAF50;
      background: rgba(76, 175, 80, 0.2);
    }

    .achievement-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .achievement-name {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .achievement-desc {
      color: #fff;
      font-size: 0.8rem;
    }

    @media (max-width: 768px) {
      /* General mobile adjustments */
      .trading-container {
        padding: 0.5rem;
        margin: 0;
      }
      
      /* Header mobile optimization */
      .trading-header {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .trading-title {
        font-size: 1.8rem;
        text-align: center;
      }
      
      .user-info {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
      
      .user-avatar {
        width: 40px;
        height: 40px;
      }
      
      .username {
        font-size: 1rem;
      }
      
      .user-stats {
        justify-content: center;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .stat-item {
        font-size: 0.7rem;
        padding: 0.1rem 0.3rem;
      }
      
      /* Date display mobile */
      .date-display {
        font-size: 1rem;
        padding: 0.5rem;
        margin-bottom: 1rem;
      }
      
      /* Fast forward buttons mobile */
      .fast-forward-container {
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
      
      .fast-forward-btn {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
        min-width: auto;
      }
      
      /* Top options bar mobile */
      .top-options-bar {
        padding: 0.6rem 0.5rem;
        gap: 0.5rem;
      }
      
      .top-option-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
      }
      
      /* Timeframe buttons mobile */
      .timeframe-buttons {
        gap: 0.3rem;
        margin-bottom: 0.8rem;
      }
      
      .timeframe-btn {
        padding: 0.3rem 0.6rem;
        font-size: 0.8rem;
        min-width: 40px;
      }
      
      /* Chart container mobile */
      .chart-container {
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .chart-title {
        font-size: 1.4rem;
      }
      
      .price-chart {
        height: 200px;
      }
      
      /* News feed mobile */
      .news-feed {
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .news-title {
        font-size: 1.4rem;
      }
      
      .news-item {
        padding: 0.8rem;
        font-size: 0.9rem;
      }
      
      /* Analytics panel mobile */
      .analytics-panel {
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .analytics-title {
        font-size: 1.4rem;
      }
      
      .analytics-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.8rem;
      }
      
      .analytics-item {
        padding: 0.8rem;
      }
      
      .analytics-value {
        font-size: 1.2rem;
      }
      
      .analytics-label {
        font-size: 0.7rem;
      }
      
      /* Mini-game panel mobile */
      .mini-game-panel {
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .prediction-buttons {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .prediction-btn {
        padding: 0.8rem;
        font-size: 1rem;
      }
      
      /* Trading workspace mobile */
      .trading-workspace {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      /* Trading panel mobile */
      .trading-panel {
        padding: 1rem;
      }
      
      .panel-title {
        font-size: 1.4rem;
      }
      
      .price-display {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
      }
      
      .current-price {
        font-size: 1.5rem;
      }
      
      .price-change {
        font-size: 1rem;
      }
      
      /* Form inputs mobile */
      .form-group {
        margin-bottom: 1rem;
      }
      
      .form-input {
        padding: 0.8rem;
        font-size: 1rem;
      }
      
      .investment-display {
        padding: 0.8rem;
        margin: 0.8rem 0;
      }
      
      /* Trading buttons mobile */
      .trading-buttons {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
      
      .trade-btn {
        padding: 1rem;
        font-size: 1.1rem;
      }
      
      /* Portfolio panel mobile */
      .portfolio-panel {
        padding: 1rem;
      }
      
      .portfolio-summary {
        grid-template-columns: 1fr;
        gap: 0.8rem;
      }
      
      .portfolio-item {
        padding: 0.8rem;
      }
      
      .portfolio-label {
        font-size: 0.9rem;
      }
      
      .portfolio-value {
        font-size: 1.2rem;
      }
      
      /* Trades history mobile */
      .trades-history {
        max-height: 200px;
      }
      
      .trade-item {
        padding: 0.6rem;
        font-size: 0.8rem;
      }
      
      /* Leaderboard mobile */
      .leaderboard-section {
        padding: 1rem;
        margin-top: 1rem;
      }
      
      .leaderboard-title {
        font-size: 1.4rem;
      }
      
      .leaderboard-table th,
      .leaderboard-table td {
        padding: 0.5rem;
        font-size: 0.8rem;
      }
      
      .leaderboard-avatar {
        width: 25px;
        height: 25px;
      }
      
      /* Achievements mobile */
      .achievements-section {
        padding: 1rem;
        margin-top: 1rem;
      }
      
      .achievements-title {
        font-size: 1.4rem;
      }
      
      .achievements-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.8rem;
      }
      
      .achievement-item {
        padding: 0.8rem;
      }
      
      .achievement-icon {
        font-size: 1.5rem;
      }
      
      .achievement-name {
        font-size: 0.8rem;
      }
      
      .achievement-desc {
        font-size: 0.7rem;
      }
      
      /* Buttons mobile */
      .logout-btn {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }
      
      .tips-btn {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
        top: 10px;
        right: 10px;
      }
      
      .sound-toggle {
        width: 40px;
        height: 40px;
        font-size: 1rem;
        bottom: 10px;
        right: 10px;
      }
      
      /* Whale status mobile */
      .whale-status {
        font-size: 0.7rem;
        padding: 0.2rem 0.5rem;
        margin-left: 0.3rem;
      }
      
      .permanent-x-btn {
        padding: 0.3rem 0.6rem;
        font-size: 0.7rem;
        margin-left: 0.3rem;
      }
      
      /* Event modal mobile */
      .event-content {
        padding: 1.5rem;
        margin: 1rem;
        max-width: 90vw;
      }
      
      .event-title {
        font-size: 1.3rem;
      }
      
      .event-description {
        font-size: 0.9rem;
      }
      
      .continue-btn {
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
      }
      
      /* Tips modal mobile */
      .tips-content {
        padding: 1.5rem;
        margin: 1rem;
        max-width: 90vw;
      }
      
      .tips-title {
        font-size: 1.3rem;
      }
      
      .tip-title {
        font-size: 1rem;
      }
      
      .tip-text {
        font-size: 0.9rem;
      }
      
          .close-tips {
      width: 30px;
      height: 30px;
      font-size: 1.2rem;
    }
    
    /* Trading Tabs Styles */
    .trading-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      border-bottom: 2px solid #FFD300;
      padding-bottom: 0.5rem;
    }
    
    .tab-btn {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      color: #FFD300;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      font-family: 'Bangers', cursive;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
    }
    
    .tab-btn:hover {
      background: rgba(255, 211, 0, 0.2);
      transform: translateY(-2px);
    }
    
    .tab-btn.active {
      background: #FFD300;
      color: #000;
      box-shadow: 0 4px 15px rgba(255, 211, 0, 0.4);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Percentage Options */
    .percentage-options {
      display: flex;
      gap: 0.5rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }
    
    .percentage-btn {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      color: #FFD300;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-family: 'Bangers', cursive;
      font-size: 0.9rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      min-width: 60px;
    }
    
    .percentage-btn:hover {
      background: rgba(255, 211, 0, 0.2);
      transform: translateY(-1px);
    }
    
    .percentage-btn.active {
      background: #FFD300;
      color: #000;
    }
    
    /* Investment Display */
    .investment-display {
      background: rgba(255, 211, 0, 0.1);
      border: 2px solid #FFD300;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem 0;
      text-align: center;
    }
    
    .investment-label {
      color: #FFD300;
      font-weight: bold;
      margin-bottom: 0.5rem;
      font-family: 'Bangers', cursive;
      font-size: 0.9rem;
    }
    
    .investment-value {
      color: #fff;
      font-size: 1.2rem;
      font-weight: bold;
    }
    
    /* Orders Section */
    .orders-section h3 {
      color: #FFD300;
      font-family: 'Bangers', cursive;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      text-shadow: 1px 1px 0px #000;
    }
    
    .orders-list {
      background: rgba(255, 211, 0, 0.05);
      border: 1px solid #FFD300;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      min-height: 100px;
    }
    
    .order-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 211, 0, 0.3);
      border-radius: 8px;
      padding: 0.8rem;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .order-info {
      flex: 1;
    }
    
    .order-type {
      font-weight: bold;
      font-family: 'Bangers', cursive;
      font-size: 0.9rem;
    }
    
    .order-type.stop-loss {
      color: #f44336;
    }
    
    .order-type.limit-buy {
      color: #4CAF50;
    }
    
    .order-type.limit-sell {
      color: #FF9800;
    }
    
    .order-details {
      color: #fff;
      font-size: 0.8rem;
      margin-top: 0.2rem;
    }
    
    .cancel-order-btn {
      background: #f44336;
      color: white;
      border: none;
      padding: 0.3rem 0.6rem;
      border-radius: 5px;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .cancel-order-btn:hover {
      background: #d32f2f;
      transform: translateY(-1px);
    }
    
    /* Notification Styles */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      font-family: 'Bangers', cursive;
      font-size: 1rem;
      z-index: 10000;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
      animation: notificationSlide 0.3s ease-out;
    }
    
    @keyframes notificationSlide {
      0% {
        opacity: 0;
        transform: translateX(100%);
      }
      100% {
        opacity: 1;
        transform: translateX(0);
      }
    }
    }
    
    /* Extra small mobile devices */
    @media (max-width: 480px) {
      .trading-title {
        font-size: 1.5rem;
      }
      
      .fast-forward-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.7rem;
      }
      
      .analytics-grid {
        grid-template-columns: 1fr;
      }
      
      .feature-grid {
        grid-template-columns: 1fr;
      }
      
      .achievements-grid {
        grid-template-columns: 1fr;
      }
      
      .current-price {
        font-size: 1.3rem;
      }
      
      .trade-btn {
        padding: 0.8rem;
        font-size: 1rem;
      }
    }
    
    /* Touch-friendly improvements for mobile */
    @media (hover: none) and (pointer: coarse) {
      /* Increase touch targets for mobile */
      .trade-btn,
      .prediction-btn,
      .fast-forward-btn,
      .logout-btn,
      .tips-btn,
      .sound-toggle,
      .start-trading-btn,
      .post-to-x-btn,
      .permanent-x-btn {
        min-height: 44px;
        min-width: 44px;
      }
      
      /* Improve button spacing for touch */
      .trading-buttons,
      .prediction-buttons {
        gap: 1rem;
      }
      
      /* Better form input sizing for mobile */
      .form-input {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 1rem;
      }
      
      /* Improve scrolling on mobile */
      .intro-content,
      .trading-container {
        -webkit-overflow-scrolling: touch;
      }
    }

    /* Top Options Bar */
    .top-options-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      border-bottom: 3px solid #FFD300;
      padding: 0.8rem 1rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    }
    
    .top-option-btn {
      background: linear-gradient(135deg, #FFD300 0%, #FF6B35 100%);
      color: #000;
      border: 2px solid #000;
      border-radius: 12px;
      padding: 0.6rem 1.2rem;
      font-family: 'Bangers', cursive;
      font-size: 0.9rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-shadow: 1px 1px 0 rgba(255,255,255,0.3);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .top-option-btn:hover {
      background: linear-gradient(135deg, #FF6B35 0%, #FFD300 100%);
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }
    
    .top-option-btn:active {
      transform: scale(0.95);
    }
    /* Fast Forward Modal */
    .fastforward-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 3000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .fastforward-modal-content {
      background: #222;
      border-radius: 18px;
      padding: 2rem 2.5rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.35);
      position: relative;
      min-width: 260px;
      text-align: center;
    }
    .close-ff-modal {
      position: absolute;
      top: 10px;
      right: 16px;
      font-size: 1.5rem;
      background: none;
      border: none;
      color: #FFD300;
      cursor: pointer;
    }
    .ff-option {
      background: linear-gradient(45deg, #FFD300, #FF6B35);
      color: #000;
      border: none;
      border-radius: 12px;
      padding: 0.7rem 1.5rem;
      font-family: 'Bangers', cursive;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255, 211, 0, 0.3);
      transition: all 0.2s;
      margin: 0.2rem 0;
    }
    .ff-option:hover {
      background: linear-gradient(45deg, #FF6B35, #FFD300);
      color: #fff;
    }
    /* Timeframe Buttons */
    .timeframe-buttons {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .timeframe-btn {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 2px solid #FFD300;
      border-radius: 8px;
      padding: 0.4rem 0.8rem;
      font-family: 'Bangers', cursive;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 50px;
    }
    
    .timeframe-btn:hover {
      background: rgba(255, 211, 0, 0.2);
      transform: scale(1.05);
    }
    
    .timeframe-btn.active {
      background: #FFD300;
      color: #000;
      font-weight: bold;
    }
    
    /* Whale Announcement Close Button */
    .whale-announcement { position: relative; }
    .close-whale-announcement { position: absolute; top: 8px; right: 12px; font-size: 1.5rem; background: none; border: none; color: #000; cursor: pointer; z-index: 10; }
  </style>
</head>
<body>
  <!-- Intro Message Overlay -->
  <div id="intro-overlay" class="intro-overlay">
    <div class="intro-content">
      <div class="intro-header">
        <img src="assets/brett%20head.png" alt="Brett" class="intro-brett-img">
        <h1 class="intro-title">üéÆ BRETT TRADING SIMULATOR</h1>
      </div>
      
      <div class="intro-body">
        <div class="intro-section">
          <h2>üêã Welcome to the Ultimate Brett Trading Experience!</h2>
          <p>Practice trading BRETT tokens with virtual money in this realistic simulation. Test your skills, compete with others, and become the best Brett trader!</p>
        </div>
        
        <div class="intro-section">
          <h3>üéØ What You Can Do:</h3>
          <ul>
            <li>üí∞ <strong>Trade BRETT tokens</strong> with realistic price movements</li>
            <li>üìà <strong>Watch live charts</strong> and market news</li>
            <li>‚ö° <strong>Fast forward time</strong> to see dramatic market events</li>
            <li>üéÆ <strong>Play prediction games</strong> to earn bonus money</li>
            <li>üèÜ <strong>Compete on leaderboards</strong> with other traders</li>
            <li>üêã <strong>Achieve whale status</strong> and post to X (Twitter)</li>
            <li>üìä <strong>Track your analytics</strong> and trading performance</li>
          </ul>
        </div>
        
        <div class="intro-section">
          <h3>‚ö†Ô∏è Important Notes:</h3>
          <ul>
            <li>üéÆ This is a <strong>simulation game</strong> - not real trading</li>
            <li>üí∞ All money and prices are <strong>virtual/fake</strong></li>
            <li>üìà Price movements are <strong>randomly generated</strong></li>
            <li>üéØ Your progress is <strong>saved locally</strong> on your device</li>
            <li>üêã Reach $100,000+ to become a <strong>Brett Whale</strong>!</li>
          </ul>
        </div>
        
        <div class="intro-section">
          <h3>üéÆ Game Features:</h3>
          <div class="feature-grid">
            <div class="feature-item">
              <span class="feature-icon">üìä</span>
              <span class="feature-text">Real-time Charts</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üì∞</span>
              <span class="feature-text">Market News</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">‚ö°</span>
              <span class="feature-text">Fast Forward</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üéØ</span>
              <span class="feature-text">Prediction Game</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üèÜ</span>
              <span class="feature-text">Leaderboard</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üêã</span>
              <span class="feature-text">Whale Status</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üì±</span>
              <span class="feature-text">X Integration</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üîä</span>
              <span class="feature-text">Sound Effects</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="intro-footer">
        <button id="start-trading-btn" class="start-trading-btn">
          üöÄ START TRADING üöÄ
        </button>
        <p class="intro-note">Click to begin your Brett trading journey!</p>
      </div>
    </div>
  </div>

  <div class="main-content-area" id="trading-platform" style="display: none;">
    <!-- Header -->
    <div class="trading-header section-panel">
      <h1 class="trading-title">üéÆ BRETT TRADING SIMULATOR</h1>
      <div class="user-info">
        <img id="user-avatar" src="" alt="User Avatar" class="user-avatar">
        <div class="user-details">
                            <div class="username-container">
                    <span id="username" class="username"></span>
                    <span id="whale-status" class="whale-status" style="display: none;">üêã WHALE</span>
                    <button id="permanent-x-btn" class="permanent-x-btn" style="display: none;" onclick="window.tradingSimulator.postToX()">
                      üêã POST TO X
                    </button>
                  </div>
          <div id="user-balance" class="user-balance"></div>
          <div class="user-stats">
            <div class="stat-item">
              <span class="stat-label">VOL:</span>
              <span id="user-volatility" class="stat-value"></span>
            </div>
            <div class="stat-item">
              <span class="stat-label">LUCK:</span>
              <span id="user-luck" class="stat-value"></span>
            </div>
            <div class="stat-item">
              <span class="stat-label">NEWS:</span>
              <span id="user-news-pref" class="stat-value"></span>
            </div>
          </div>
        </div>
        <button class="logout-btn" id="logout-btn">LOGOUT</button>
      </div>
    </div>
    <!-- Date Display -->
    <div id="date-display" class="date-display">üìÖ January 15, 2024</div>
    <!-- Top Options Bar -->
    <div class="top-options-bar">
      <button class="top-option-btn" id="fast-forward-btn" title="Fast Forward">‚è© FAST FORWARD</button>
      <button class="top-option-btn" id="tips-btn-top" title="Trading Tips">üí° TIPS</button>
      <button class="top-option-btn" id="settings-btn" title="Settings">‚öôÔ∏è SETTINGS</button>
    </div>
    <!-- Price Chart -->
    <div class="chart-container section-panel">
      <h2 class="chart-title">üìà BRETT PRICE CHART</h2>
      <!-- Timeframe Buttons -->
      <div class="timeframe-buttons">
        <button class="timeframe-btn active" data-timeframe="1m">1M</button>
        <button class="timeframe-btn" data-timeframe="5m">5M</button>
        <button class="timeframe-btn" data-timeframe="15m">15M</button>
        <button class="timeframe-btn" data-timeframe="1h">1H</button>
        <button class="timeframe-btn" data-timeframe="4h">4H</button>
        <button class="timeframe-btn" data-timeframe="1d">1D</button>
        <button class="timeframe-btn" data-timeframe="1w">1W</button>
      </div>
      <div class="price-chart" id="price-chart">
        <!-- Candlesticks will be drawn here -->
      </div>
    </div>
    <!-- News Feed -->
    <div class="news-feed section-panel">
      <h2 class="news-title">üì∞ MARKET NEWS</h2>
      <div id="news-container">
        <!-- News items will be populated here -->
      </div>
    </div>
    <!-- Analytics Panel -->
    <div class="analytics-panel section-panel">
      <h2 class="analytics-title">üìä TRADING ANALYTICS</h2>
      <div class="analytics-grid">
        <div class="analytics-item">
          <div id="win-rate" class="analytics-value">0%</div>
          <div class="analytics-label">WIN RATE</div>
        </div>
        <div class="analytics-item">
          <div id="total-trades" class="analytics-value">0</div>
          <div class="analytics-label">TOTAL TRADES</div>
        </div>
        <div class="analytics-item">
          <div id="best-trade" class="analytics-value">$0</div>
          <div class="analytics-label">BEST TRADE</div>
        </div>
        <div class="analytics-item">
          <div id="current-streak" class="analytics-value">0</div>
          <div class="analytics-label">WIN STREAK</div>
        </div>
        <div class="analytics-item">
          <div id="avg-trade" class="analytics-value">$0</div>
          <div class="analytics-label">AVG TRADE</div>
        </div>
        <div class="analytics-item">
          <div id="prediction-accuracy" class="analytics-value">0%</div>
          <div class="analytics-label">PREDICTION ACCURACY</div>
        </div>
      </div>
    </div>
    <!-- Mini-Game Panel -->
    <div class="mini-game-panel section-panel">
      <h2 class="analytics-title">üéÆ PRICE PREDICTION GAME</h2>
      <div class="prediction-game">
        <p style="color: #fff; text-align: center; margin-bottom: 1rem;">
          Predict the next price movement! Get it right to earn +10% bonus money, wrong and lose -10%!
        </p>
        <div class="prediction-buttons">
          <button id="predict-up" class="prediction-btn">üìà PRICE UP</button>
          <button id="predict-down" class="prediction-btn">üìâ PRICE DOWN</button>
        </div>
        <div id="prediction-result" style="text-align: center; margin-top: 1rem; font-weight: bold;"></div>
      </div>
    </div>
    <!-- Trading Workspace -->
    <div class="trading-workspace section-panel">
      <!-- Trading Panel -->
      <div class="trading-panel">
        <h2 class="panel-title">üí∞ TRADE BRETT</h2>
        
        <!-- Price Display -->
        <div class="price-display">
          <div id="current-price" class="current-price">$0.001234</div>
          <div id="price-change" class="price-change positive">+12.34%</div>
        </div>
        
        <!-- Trading Tabs -->
        <div class="trading-tabs">
          <button class="tab-btn active" data-tab="buy">üìà BUY</button>
          <button class="tab-btn" data-tab="sell">üìâ SELL</button>
          <button class="tab-btn" data-tab="orders">üìã ORDERS</button>
        </div>
        
        <!-- Buy Tab -->
        <div class="tab-content active" id="buy-tab">
          <form class="trading-form" id="buy-form">
            <div class="form-group">
              <label for="buy-amount">Amount of BRETT</label>
              <input type="number" id="buy-amount" class="form-input" placeholder="Enter amount" min="1" step="1">
            </div>
            
            <div class="form-group">
              <label for="buy-price">Price per BRETT</label>
              <input type="number" id="buy-price" class="form-input" placeholder="Enter price" min="0.000001" step="0.000001">
            </div>
            
            <!-- Buy Percentage Options -->
            <div class="percentage-options">
              <button type="button" class="percentage-btn" data-percentage="25">25%</button>
              <button type="button" class="percentage-btn" data-percentage="50">50%</button>
              <button type="button" class="percentage-btn" data-percentage="75">75%</button>
              <button type="button" class="percentage-btn" data-percentage="100">100%</button>
            </div>
            
            <!-- Investment Amount Display -->
            <div class="investment-display">
              <div class="investment-label">INVESTMENT AMOUNT</div>
              <div id="buy-investment-amount" class="investment-value">$0.00</div>
            </div>
            
            <div class="trading-buttons">
              <button type="button" class="trade-btn buy-btn" id="buy-btn">BUY BRETT</button>
            </div>
          </form>
        </div>
        
        <!-- Sell Tab -->
        <div class="tab-content" id="sell-tab">
          <form class="trading-form" id="sell-form">
            <div class="form-group">
              <label for="sell-amount">Amount of BRETT</label>
              <input type="number" id="sell-amount" class="form-input" placeholder="Enter amount" min="1" step="1">
            </div>
            
            <div class="form-group">
              <label for="sell-price">Price per BRETT</label>
              <input type="number" id="sell-price" class="form-input" placeholder="Enter price" min="0.000001" step="0.000001">
            </div>
            
            <!-- Sell Percentage Options -->
            <div class="percentage-options">
              <button type="button" class="percentage-btn" data-percentage="25">25%</button>
              <button type="button" class="percentage-btn" data-percentage="50">50%</button>
              <button type="button" class="percentage-btn" data-percentage="75">75%</button>
              <button type="button" class="percentage-btn" data-percentage="100">100%</button>
            </div>
            
            <!-- Investment Amount Display -->
            <div class="investment-display">
              <div class="investment-label">SALE VALUE</div>
              <div id="sell-investment-amount" class="investment-value">$0.00</div>
            </div>
            
            <div class="trading-buttons">
              <button type="button" class="trade-btn sell-btn" id="sell-btn">SELL BRETT</button>
            </div>
          </form>
        </div>
        
        <!-- Orders Tab -->
        <div class="tab-content" id="orders-tab">
          <div class="orders-section">
            <h3>üõë Stop Loss Orders</h3>
            <div id="stop-loss-orders" class="orders-list">
              <!-- Stop loss orders will be displayed here -->
            </div>
            
            <h3>üìã Limit Orders</h3>
            <div id="limit-orders" class="orders-list">
              <!-- Limit orders will be displayed here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Portfolio Panel -->
      <div class="portfolio-panel">
        <h2 class="panel-title">üìä YOUR PORTFOLIO</h2>
        
        <div class="portfolio-summary">
          <div class="portfolio-item">
            <div class="portfolio-label">BRETT HOLDINGS</div>
            <div id="brett-holdings" class="portfolio-value">0 BRETT</div>
          </div>
          <div class="portfolio-item">
            <div class="portfolio-label">CASH BALANCE</div>
            <div id="cash-balance" class="portfolio-value">$10,000</div>
          </div>
          <div class="portfolio-item">
            <div class="portfolio-label">TOTAL VALUE</div>
            <div id="total-value" class="portfolio-value">$10,000</div>
          </div>
          <div class="portfolio-item">
            <div class="portfolio-label">PROFIT/LOSS</div>
            <div id="total-profit" class="portfolio-value">$0</div>
          </div>
        </div>
        
        <h3 style="color: #FFD300; font-family: 'Bangers', cursive; margin-bottom: 1rem;">Recent Trades</h3>
        <div id="trades-history" class="trades-history">
          <!-- Trades will be populated here -->
        </div>
      </div>
    </div>

    <!-- Leaderboard Section -->
    <div class="leaderboard-section">
      <h2 class="leaderboard-title">üèÜ LEADERBOARD</h2>
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Trader</th>
            <th>Total Profit</th>
            <th>Profit %</th>
            <th>Total Trades</th>
          </tr>
        </thead>
        <tbody id="leaderboard-body">
          <!-- Leaderboard will be populated here -->
        </tbody>
      </table>
    </div>

    <!-- Achievements Section -->
    <div class="achievements-section">
      <h2 class="panel-title">üèÖ ACHIEVEMENTS</h2>
      <div id="achievements-grid" class="achievements-grid">
        <!-- Achievements will be populated here -->
      </div>
    </div>
  </div>

  <!-- Whale Announcement Modal (add close button inside) -->
  <div class="whale-announcement" id="whale-announcement" style="display:none;">
    <button class="close-whale-announcement" title="Close" style="position:absolute;top:8px;right:12px;font-size:1.5rem;background:none;border:none;color:#000;cursor:pointer;z-index:10;">√ó</button>
    <!-- existing whale announcement content here -->
  </div>

  <script>
    // Add this function near the top of the script section:
    function showSimulatorError(msg) {
      let errDiv = document.getElementById('simulator-error');
      if (!errDiv) {
        errDiv = document.createElement('div');
        errDiv.id = 'simulator-error';
        errDiv.style.background = '#f44336';
        errDiv.style.color = '#fff';
        errDiv.style.fontWeight = 'bold';
        errDiv.style.padding = '1rem';
        errDiv.style.textAlign = 'center';
        errDiv.style.zIndex = '9999';
        errDiv.style.position = 'fixed';
        errDiv.style.top = '0';
        errDiv.style.left = '0';
        errDiv.style.right = '0';
        document.body.prepend(errDiv);
      }
      errDiv.textContent = 'Trading Simulator Error: ' + msg;
    }

    class TradingSimulator {
      constructor() {
        this.currentUser = JSON.parse(localStorage.getItem('brettTradingCurrentUser'));
        this.users = JSON.parse(localStorage.getItem('brettTradingUsers')) || [];
        this.priceUpdateInterval = null;
        this.newsItems = [];
        this.chartData = [];
        this.currentDate = new Date('2024-01-15');
        this.fastForwardCooldown = false;
        
        if (!this.currentUser) {
          window.location.href = '/login';
          return;
        }
        
        // Generate user-specific starting price based on username
        this.currentPrice = this.generateUserStartingPrice();
        this.priceHistory = [this.currentPrice];
        
        // User-specific settings
        this.userVolatility = this.generateUserVolatility();
        this.userLuck = this.generateUserLuck();
        this.userNewsPreference = this.generateUserNewsPreference();
        
        // Analytics and game settings
        this.soundEnabled = true;
        this.predictionHistory = [];
        this.currentPrediction = null;
        this.winStreak = 0;
        this.isWhale = false;
        this.whaleAnnounced = false;
        
        // Don't auto-init - wait for user to click "Start Trading"
        this.setupEventListeners();
        console.log('Trading Simulator initialized - waiting for user to click Start Trading');
      }

      // User-specific generation methods
      generateUserStartingPrice() {
        // Use username hash to generate consistent but unique starting price
        const username = this.currentUser.username.toLowerCase();
        let hash = 0;
        for (let i = 0; i < username.length; i++) {
          hash = ((hash << 5) - hash) + username.charCodeAt(i);
          hash = hash & hash; // Convert to 32-bit integer
        }
        
        // Generate price between 0.0005 and 0.0025 based on hash
        const basePrice = 0.0005 + (Math.abs(hash) % 2000) / 1000000;
        return basePrice;
      }

      generateUserVolatility() {
        // Generate volatility based on username
        const username = this.currentUser.username.toLowerCase();
        let hash = 0;
        for (let i = 0; i < username.length; i++) {
          hash = ((hash << 5) - hash) + username.charCodeAt(i);
          hash = hash & hash;
        }
        
        // Volatility between 0.5x and 2x normal
        return 0.5 + (Math.abs(hash) % 150) / 100;
      }

      generateUserLuck() {
        // Generate luck factor based on username
        const username = this.currentUser.username.toLowerCase();
        let hash = 0;
        for (let i = 0; i < username.length; i++) {
          hash = ((hash << 5) - hash) + username.charCodeAt(i);
          hash = hash & hash;
        }
        
        // Luck between -0.3 and +0.3
        return (Math.abs(hash) % 60 - 30) / 100;
      }

      generateUserNewsPreference() {
        // Generate news preference based on username
        const username = this.currentUser.username.toLowerCase();
        let hash = 0;
        for (let i = 0; i < username.length; i++) {
          hash = ((hash << 5) - hash) + username.charCodeAt(i);
          hash = hash & hash;
        }
        
        // Preference: 'bullish', 'bearish', or 'neutral'
        const preferences = ['bullish', 'bearish', 'neutral'];
        return preferences[Math.abs(hash) % 3];
      }
      
      init() {
        this.setupEventListeners();
        this.updateUI();
        this.updateAnalytics();
        this.startPriceUpdates();
        this.startNewsUpdates();
        this.startDateUpdates();
        this.updateLeaderboard();
        this.loadAchievements();
        this.initializeChart();
      }
      
      setupEventListeners() {
        // Intro overlay
        document.getElementById('start-trading-btn').addEventListener('click', () => this.startTrading());
        
        // Trading tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', () => this.switchTab(btn.dataset.tab));
        });
        
        // Percentage buttons
        document.querySelectorAll('.percentage-btn').forEach(btn => {
          btn.addEventListener('click', () => this.setPercentage(btn.dataset.percentage));
        });
        
        document.getElementById('buy-btn').addEventListener('click', () => this.executeTrade('buy'));
        document.getElementById('sell-btn').addEventListener('click', () => this.executeTrade('sell'));
        document.getElementById('logout-btn').addEventListener('click', () => this.logout());
        
        // Fast forward buttons
        document.querySelectorAll('.fast-forward-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const timeFrame = btn.getAttribute('data-time');
            this.triggerFastForward(timeFrame);
          });
        });
        
        // Prediction game buttons
        document.getElementById('predict-up').addEventListener('click', () => this.makePrediction('up'));
        document.getElementById('predict-down').addEventListener('click', () => this.makePrediction('down'));
        
        // Calculate investment amount when inputs change
        document.getElementById('buy-amount').addEventListener('input', () => this.calculateInvestment('buy'));
        document.getElementById('buy-price').addEventListener('input', () => this.calculateInvestment('buy'));
        document.getElementById('sell-amount').addEventListener('input', () => this.calculateInvestment('sell'));
        document.getElementById('sell-price').addEventListener('input', () => this.calculateInvestment('sell'));
        
        console.log('Trading Simulator event listeners set up successfully');
      }
      
      startPriceUpdates() {
        this.priceUpdateInterval = setInterval(() => {
          this.updatePrice();
        }, 2000); // Update every 2 seconds for faster action
      }
      
      updatePrice() {
        // Balanced price movements with more realistic volatility
        let baseChange;
        if (Math.random() < 0.3) { // 30% chance for significant movement
          baseChange = (Math.random() - 0.5) * 0.2; // Balanced ¬±10% volatility
        } else {
          baseChange = (Math.random() - 0.5) * 0.1; // Balanced ¬±5% volatility
        }
        
        const volatilityChange = baseChange * this.userVolatility;
        const luckChange = this.userLuck * 0.01; // Reduced luck influence
        
        const totalChange = volatilityChange + luckChange;
        const newPrice = this.currentPrice * (1 + totalChange);
        this.currentPrice = Math.max(0.000001, newPrice);
        this.priceHistory.push(this.currentPrice);
        
        if (this.priceHistory.length > 100) {
          this.priceHistory.shift();
        }
        
        this.updatePriceDisplay();
        this.updateChartData();
        
        // Check stop losses and limit orders
        this.checkStopLosses();
        this.checkLimitOrders();
        
        // Check prediction and play sound
        this.checkPrediction();
        if (this.priceHistory.length > 1) {
          const previousPrice = this.priceHistory[this.priceHistory.length - 2];
          if (this.currentPrice > previousPrice) {
            this.playSound('price_up');
          } else if (this.currentPrice < previousPrice) {
            this.playSound('price_down');
          }
        }
      }
      
      updatePriceDisplay() {
        const priceElement = document.getElementById('current-price');
        const changeElement = document.getElementById('price-change');
        
        priceElement.textContent = `$${this.currentPrice.toFixed(6)}`;
        
        if (this.priceHistory.length > 1) {
          const previousPrice = this.priceHistory[this.priceHistory.length - 2];
          const change = ((this.currentPrice - previousPrice) / previousPrice) * 100;
          
          changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
          changeElement.className = `price-change ${change >= 0 ? 'positive' : 'negative'}`;
        }
        
        document.getElementById('buy-price').value = this.currentPrice.toFixed(6);
        document.getElementById('sell-price').value = this.currentPrice.toFixed(6);
      }
      
      executeTrade(type) {
        const amount = parseFloat(document.getElementById(`${type}-amount`).value);
        const price = parseFloat(document.getElementById(`${type}-price`).value);
        
        if (!amount || !price || amount <= 0 || price <= 0) {
          alert('Please enter valid amount and price');
          return;
        }
        
        const totalCost = amount * price;
        
        if (type === 'buy') {
          if (totalCost > this.currentUser.balance) {
            alert('Insufficient funds');
            return;
          }
          
          this.currentUser.balance -= totalCost;
          this.currentUser.brettHoldings = (this.currentUser.brettHoldings || 0) + amount;
        } else {
          if (amount > (this.currentUser.brettHoldings || 0)) {
            alert('Insufficient BRETT holdings');
            return;
          }
          
          this.currentUser.balance += totalCost;
          this.currentUser.brettHoldings -= amount;
        }
        
        // Record trade
        const trade = {
          id: Date.now(),
          type: type,
          amount: amount,
          price: price,
          total: totalCost,
          timestamp: new Date().toISOString(),
          profit: type === 'sell' ? this.calculateProfit(amount, price) : 0
        };
        
        this.currentUser.trades = this.currentUser.trades || [];
        this.currentUser.trades.unshift(trade);
        
        // Update user data
        this.updateUserData();
        this.updateUI();
        this.updateAnalytics();
        this.checkAchievements();
        this.updateLeaderboard();
        
        // Play trade sound
        this.playSound('trade');
        
        // Clear form
        document.getElementById(`${type}-amount`).value = '';
        document.getElementById(`${type}-price`).value = '';
        document.getElementById(`${type}-investment-amount`).textContent = '$0.00';
        
        // Clear percentage buttons
        document.querySelectorAll('.percentage-btn').forEach(btn => {
          btn.classList.remove('active');
        });
      }
      
      calculateProfit(amount, sellPrice) {
        // Simple profit calculation (in real app, you'd track buy prices)
        const avgBuyPrice = 0.001; // Simplified
        return (sellPrice - avgBuyPrice) * amount;
      }
      
      updateUserData() {
        // Update user in users array
        const userIndex = this.users.findIndex(u => u.id === this.currentUser.id);
        if (userIndex !== -1) {
          this.users[userIndex] = this.currentUser;
        }
        
        // Save to localStorage
        localStorage.setItem('brettTradingUsers', JSON.stringify(this.users));
        localStorage.setItem('brettTradingCurrentUser', JSON.stringify(this.currentUser));
      }
      
      updateUI() {
        // Update user info
        document.getElementById('user-avatar').src = `assets/${this.currentUser.profilePicture}`;
        document.getElementById('username').textContent = this.currentUser.username;
        document.getElementById('user-balance').textContent = `$${this.currentUser.balance.toFixed(2)}`;
        
        // Check for whale status
        this.checkWhaleStatus();
        
        // Update user stats
        document.getElementById('user-volatility').textContent = `${this.userVolatility.toFixed(1)}x`;
        document.getElementById('user-luck').textContent = `${this.userLuck >= 0 ? '+' : ''}${(this.userLuck * 100).toFixed(0)}%`;
        document.getElementById('user-news-pref').textContent = this.userNewsPreference.toUpperCase();
        
        // Update portfolio
        const brettHoldings = this.currentUser.brettHoldings || 0;
        const totalValue = this.currentUser.balance + (brettHoldings * this.currentPrice);
        const totalProfit = totalValue - 10000; // Starting balance
        
        document.getElementById('brett-holdings').textContent = `${brettHoldings.toLocaleString()} BRETT`;
        document.getElementById('cash-balance').textContent = `$${this.currentUser.balance.toFixed(2)}`;
        document.getElementById('total-value').textContent = `$${totalValue.toFixed(2)}`;
        
        const profitElement = document.getElementById('total-profit');
        profitElement.textContent = `$${totalProfit.toFixed(2)}`;
        profitElement.className = `portfolio-value ${totalProfit >= 0 ? 'positive' : 'negative'}`;
        
        // Update trades history
        this.updateTradesHistory();
      }
      
      updateTradesHistory() {
        const tradesContainer = document.getElementById('trades-history');
        const trades = this.currentUser.trades || [];
        
        tradesContainer.innerHTML = trades.slice(0, 10).map(trade => `
          <div class="trade-item">
            <span class="trade-type ${trade.type}">${trade.type.toUpperCase()}</span>
            <span class="trade-details">${trade.amount.toLocaleString()} BRETT @ $${trade.price.toFixed(6)}</span>
            <span class="trade-profit ${trade.profit >= 0 ? 'positive' : 'negative'}">
              ${trade.profit >= 0 ? '+' : ''}$${trade.profit.toFixed(2)}
            </span>
          </div>
        `).join('');
      }

      // Chart functionality
      initializeChart() {
        this.chartData = [];
        for (let i = 0; i < 50; i++) {
          this.chartData.push({
            open: 0.001 + Math.random() * 0.002,
            high: 0.001 + Math.random() * 0.003,
            low: 0.001 + Math.random() * 0.001,
            close: 0.001 + Math.random() * 0.002
          });
        }
        this.updateChart();
      }

      updateChart() {
        const chartContainer = document.getElementById('price-chart');
        chartContainer.innerHTML = '';
        
        const maxPrice = Math.max(...this.chartData.map(d => d.high));
        const minPrice = Math.min(...this.chartData.map(d => d.low));
        const priceRange = maxPrice - minPrice;
        const chartWidth = chartContainer.offsetWidth;
        const chartHeight = chartContainer.offsetHeight;
        
        this.chartData.forEach((candle, index) => {
          const x = (index / this.chartData.length) * chartWidth;
          const isGreen = candle.close >= candle.open;
          
          // Candle body
          const bodyHeight = Math.abs(candle.close - candle.open) / priceRange * chartHeight * 0.8;
          const bodyY = chartHeight - ((candle.close + candle.open) / 2 / priceRange * chartHeight);
          
          const body = document.createElement('div');
          body.className = `candlestick ${isGreen ? '' : 'red'}`;
          body.style.left = `${x}px`;
          body.style.top = `${bodyY}px`;
          body.style.height = `${Math.max(bodyHeight, 2)}px`;
          chartContainer.appendChild(body);
          
          // Wick
          const wickHeight = (candle.high - candle.low) / priceRange * chartHeight * 0.8;
          const wickY = chartHeight - (candle.high / priceRange * chartHeight);
          
          const wick = document.createElement('div');
          wick.className = 'candlestick wick';
          wick.style.left = `${x + 3}px`;
          wick.style.top = `${wickY}px`;
          wick.style.height = `${wickHeight}px`;
          chartContainer.appendChild(wick);
        });
      }

      // News functionality
      startNewsUpdates() {
        this.generateInitialNews();
        setInterval(() => {
          this.addNewsItem();
        }, 5000); // Add news every 5 seconds
      }

      generateInitialNews() {
        const username = this.currentUser.username;
        const userSpecificNews = [
          { text: `Welcome ${username}! Brett community celebrates 100k holders milestone! üéâ`, sentiment: 'bullish' },
          { text: `New partnership announcement expected this week - ${username} might be interested!`, sentiment: 'bullish' },
          { text: `Market analysts predict BRETT price consolidation for traders like ${username}`, sentiment: 'neutral' },
          { text: `Whale wallet moves 1M BRETT tokens - ${username} should watch closely!`, sentiment: 'bearish' },
          { text: `Brett meme contest winners announced - ${username} could be next!`, sentiment: 'bullish' }
        ];
        
        // Add user-specific news based on preference
        const preferenceNews = this.getUserSpecificNews();
        const allNews = [...userSpecificNews, ...preferenceNews];
        
        // Shuffle and take first 5
        for (let i = allNews.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [allNews[i], allNews[j]] = [allNews[j], allNews[i]];
        }
        
        allNews.slice(0, 5).forEach(news => {
          this.addNewsItem(news.text, news.sentiment);
        });
      }

      getUserSpecificNews() {
        const username = this.currentUser.username;
        const newsByPreference = {
          bullish: [
            { text: `${username} spotted buying the dip! Diamond hands! üíé`, sentiment: 'bullish' },
            { text: `Brett community welcomes ${username} as a new whale! üê≥`, sentiment: 'bullish' },
            { text: `${username}'s trading strategy shows promise! üìà`, sentiment: 'bullish' },
            { text: `Brett developers notice ${username}'s positive community contributions!`, sentiment: 'bullish' },
            { text: `${username} leads the charge in Brett adoption! üöÄ`, sentiment: 'bullish' }
          ],
          bearish: [
            { text: `${username} might want to reconsider their position! üìâ`, sentiment: 'bearish' },
            { text: `Market volatility concerns ${username} and other traders!`, sentiment: 'bearish' },
            { text: `${username} should watch for potential downturns! ‚ö†Ô∏è`, sentiment: 'bearish' },
            { text: `Brett price action worries traders like ${username}!`, sentiment: 'bearish' },
            { text: `${username} faces challenging market conditions! üî¥`, sentiment: 'bearish' }
          ],
          neutral: [
            { text: `${username} maintains balanced portfolio approach! ‚öñÔ∏è`, sentiment: 'neutral' },
            { text: `Market conditions remain stable for ${username}! üìä`, sentiment: 'neutral' },
            { text: `${username} takes measured approach to Brett trading!`, sentiment: 'neutral' },
            { text: `Brett price consolidation benefits ${username}!`, sentiment: 'neutral' },
            { text: `${username} shows patience in volatile market! üßò`, sentiment: 'neutral' }
          ]
        };
        
        return newsByPreference[this.userNewsPreference] || newsByPreference.neutral;
      }

      addNewsItem(text = null, sentiment = null) {
        if (!text) {
          const username = this.currentUser.username;
          const generalNews = [
            { text: "Brett community grows by 5% this week! üöÄ", sentiment: 'bullish' },
            { text: "New Brett merchandise collection launching soon", sentiment: 'bullish' },
            { text: "Technical analysis shows support at current levels", sentiment: 'neutral' },
            { text: "Market volatility increases as traders take profits", sentiment: 'bearish' },
            { text: "Brett developers announce upcoming features", sentiment: 'bullish' },
            { text: "Large sell order detected on DEX", sentiment: 'bearish' },
            { text: "Brett reaches new social media milestones", sentiment: 'bullish' },
            { text: "Market sentiment remains mixed", sentiment: 'neutral' },
            { text: "Brett ecosystem expands with new integrations", sentiment: 'bullish' },
            { text: "Profit taking causes temporary price dip", sentiment: 'bearish' },
            { text: "BREAKING: Brett mentioned by Elon Musk! üöÄ", sentiment: 'bullish' },
            { text: "Whale alert: 10M BRETT tokens moved to cold storage", sentiment: 'bullish' },
            { text: "Brett meme goes viral on TikTok! üì±", sentiment: 'bullish' },
            { text: "Major influencer endorses Brett token", sentiment: 'bullish' },
            { text: "Brett community donates to charity! ‚ù§Ô∏è", sentiment: 'bullish' },
            { text: "Technical glitch causes temporary price spike", sentiment: 'neutral' },
            { text: "Market makers adjust liquidity pools", sentiment: 'neutral' },
            { text: "Brett holders reach 500k milestone! üéâ", sentiment: 'bullish' },
            { text: "FUD spreaders target Brett community", sentiment: 'bearish' },
            { text: "Competing meme token launches", sentiment: 'bearish' },
            { text: "Brett burns 1M tokens! üî•", sentiment: 'bullish' },
            { text: "New Brett NFT collection announced", sentiment: 'bullish' },
            { text: "Brett gaming platform development revealed", sentiment: 'bullish' },
            { text: "Market correction affects all meme tokens", sentiment: 'bearish' },
            { text: "Brett staking rewards increased! üí∞", sentiment: 'bullish' },
            { text: "Brett DAO governance proposal submitted", sentiment: 'neutral' },
            { text: "Brett cross-chain bridge goes live", sentiment: 'bullish' },
            { text: "Brett metaverse integration teased", sentiment: 'bullish' },
            { text: "‚ö†Ô∏è WARNING: High volatility detected!", sentiment: 'bearish' },
            { text: "üö® Market uncertainty increasing!", sentiment: 'bearish' },
            { text: "üìâ Bearish signals appearing!", sentiment: 'bearish' },
            { text: "üò∞ FUD spreading in the community!", sentiment: 'bearish' },
            { text: "üêã Whale dump rumours circulating!", sentiment: 'bearish' },
            { text: "üí∏ Profit taking intensifies!", sentiment: 'bearish' },
            { text: "üìä Technical indicators turning bearish!", sentiment: 'bearish' },
            { text: "‚ö° Flash crash warnings issued!", sentiment: 'bearish' },
            { text: "üî¥ Market correction expected!", sentiment: 'bearish' },
            { text: "üí• Volatility spike incoming!", sentiment: 'bearish' },
            { text: "üö´ Exchange delisting rumours!", sentiment: 'bearish' },
            { text: "üíÄ Death spiral fears grow!", sentiment: 'bearish' },
            { text: "‚ò¢Ô∏è Nuclear sell-off begins!", sentiment: 'bearish' },
            { text: "üèÉ Rug pull concerns surface!", sentiment: 'bearish' },
            { text: "üåç Global economic crisis impacts crypto!", sentiment: 'bearish' },
            { text: "ü¶¢ Black swan event detected!", sentiment: 'bearish' },
            { text: "‚ò†Ô∏è Total market destruction!", sentiment: 'bearish' },
            { text: "ü¶ñ Extinction event for meme coins!", sentiment: 'bearish' },
            { text: "üíß Liquidity crisis deepening!", sentiment: 'bearish' },
            { text: "üè¶ Smart money fleeing the market!", sentiment: 'bearish' },
            { text: "üîß Technical failure detected!", sentiment: 'bearish' },
            { text: "‚öñÔ∏è Regulatory crackdown fears!", sentiment: 'bearish' },
            { text: "ü•ä Competitor launching aggressive campaign!", sentiment: 'bearish' }
          ];
          
          // Add user-specific news with higher probability
          const userNews = this.getUserSpecificNews();
          const allNews = [...generalNews, ...userNews, ...userNews]; // User news appears twice for higher chance
          
          // Weighted selection with increased bearish probability
          let selectedNews;
          if (Math.random() < 0.4) { // 40% chance for user-specific news
            selectedNews = userNews[Math.floor(Math.random() * userNews.length)];
          } else {
            // Increase bearish news probability to 50%
            const bearishNews = generalNews.filter(news => news.sentiment === 'bearish');
            const otherNews = generalNews.filter(news => news.sentiment !== 'bearish');
            
            if (Math.random() < 0.5) { // 50% chance for bearish news
              selectedNews = bearishNews[Math.floor(Math.random() * bearishNews.length)];
            } else {
              selectedNews = otherNews[Math.floor(Math.random() * otherNews.length)];
            }
          }
          
          text = selectedNews.text;
          sentiment = selectedNews.sentiment;
        }
        
        const newsItem = {
          id: Date.now(),
          text: text,
          sentiment: sentiment,
          timestamp: new Date().toISOString()
        };
        
        this.newsItems.unshift(newsItem);
        if (this.newsItems.length > 8) {
          this.newsItems.pop();
        }
        
        this.updateNewsDisplay();
        this.affectPriceFromNews(sentiment);
      }

      updateNewsDisplay() {
        const newsContainer = document.getElementById('news-container');
        newsContainer.innerHTML = this.newsItems.map(news => {
          const time = new Date(news.timestamp).toLocaleTimeString();
          return `
            <div class="news-item ${news.sentiment}">
              <div class="news-time">${time}</div>
              <div class="news-text">${news.text}</div>
            </div>
          `;
        }).join('');
      }

      affectPriceFromNews(sentiment) {
        let priceImpact = 0;
        
        switch (sentiment) {
          case 'bullish':
            priceImpact = (Math.random() * 0.03) + 0.01; // +1% to +4%
            break;
          case 'bearish':
            priceImpact = -(Math.random() * 0.03) - 0.01; // -1% to -4%
            break;
          case 'neutral':
            priceImpact = (Math.random() - 0.5) * 0.02; // ¬±1%
            break;
        }
        
        // Apply price impact
        this.currentPrice *= (1 + priceImpact);
        this.currentPrice = Math.max(0.000001, this.currentPrice);
        
        // Update chart data
        this.updateChartData();
      }

      updateChartData() {
        const newCandle = {
          open: this.chartData[this.chartData.length - 1]?.close || this.currentPrice,
          high: this.currentPrice * (1 + Math.random() * 0.02),
          low: this.currentPrice * (1 - Math.random() * 0.02),
          close: this.currentPrice
        };
        
        this.chartData.push(newCandle);
        if (this.chartData.length > 50) {
          this.chartData.shift();
        }
        
                this.updateChart();
      }

      // Analytics methods
      updateAnalytics() {
        const trades = this.currentUser.trades || [];
        
        // Win rate
        const profitableTrades = trades.filter(trade => trade.profit > 0).length;
        const winRate = trades.length > 0 ? (profitableTrades / trades.length * 100) : 0;
        document.getElementById('win-rate').textContent = `${winRate.toFixed(1)}%`;
        
        // Total trades
        document.getElementById('total-trades').textContent = trades.length;
        
        // Best trade
        const bestTrade = trades.length > 0 ? Math.max(...trades.map(t => t.profit)) : 0;
        document.getElementById('best-trade').textContent = `$${bestTrade.toFixed(2)}`;
        
        // Win streak
        document.getElementById('current-streak').textContent = this.winStreak;
        
        // Average trade
        const avgTrade = trades.length > 0 ? trades.reduce((sum, t) => sum + t.profit, 0) / trades.length : 0;
        document.getElementById('avg-trade').textContent = `$${avgTrade.toFixed(2)}`;
        
        // Prediction accuracy
        const correctPredictions = this.predictionHistory.filter(p => p.correct).length;
        const predictionAccuracy = this.predictionHistory.length > 0 ? (correctPredictions / this.predictionHistory.length * 100) : 0;
        document.getElementById('prediction-accuracy').textContent = `${predictionAccuracy.toFixed(1)}%`;
      }

      // Prediction game methods
      makePrediction(direction) {
        if (this.currentPrediction) {
          alert('Wait for the next price update to make another prediction!');
          return;
        }
        
        this.currentPrediction = {
          direction: direction,
          price: this.currentPrice,
          timestamp: Date.now()
        };
        
        // Disable prediction buttons
        document.getElementById('predict-up').disabled = true;
        document.getElementById('predict-down').disabled = true;
        
        // Show prediction made
        document.getElementById('prediction-result').textContent = `Prediction: ${direction.toUpperCase()} üìä`;
        document.getElementById('prediction-result').style.color = '#FFD300';
      }

      checkPrediction() {
        if (!this.currentPrediction) return;
        
        const currentPrice = this.currentPrice;
        const predictedPrice = this.currentPrediction.price;
        const predictedDirection = this.currentPrediction.direction;
        
        const actualDirection = currentPrice > predictedPrice ? 'up' : 'down';
        const isCorrect = predictedDirection === actualDirection;
        
        // Record prediction result
        this.predictionHistory.push({
          ...this.currentPrediction,
          correct: isCorrect,
          actualPrice: currentPrice
        });
        
        // Update win streak
        if (isCorrect) {
          this.winStreak++;
        } else {
          this.winStreak = 0;
        }
        
        // Give money rewards/penalties
        const rewardAmount = this.currentUser.balance * 0.1; // 10% of current balance
        if (isCorrect) {
          this.currentUser.balance += rewardAmount;
        } else {
          this.currentUser.balance -= rewardAmount;
          this.currentUser.balance = Math.max(0, this.currentUser.balance); // Don't go below 0
        }
        
        // Update user data
        this.updateUserData();
        
        // Show result
        const resultElement = document.getElementById('prediction-result');
        if (isCorrect) {
          resultElement.textContent = `‚úÖ CORRECT! +$${rewardAmount.toFixed(2)} (+10%)`;
          resultElement.style.color = '#4CAF50';
          this.playSound('success');
        } else {
          resultElement.textContent = `‚ùå WRONG! -$${rewardAmount.toFixed(2)} (-10%)`;
          resultElement.style.color = '#f44336';
          this.playSound('error');
        }
        
        // Re-enable prediction buttons after 3 seconds
        setTimeout(() => {
          document.getElementById('predict-up').disabled = false;
          document.getElementById('predict-down').disabled = false;
          document.getElementById('prediction-result').textContent = '';
        }, 3000);
        
        this.currentPrediction = null;
        this.updateAnalytics();
        this.updateUI();
      }

      // Sound methods
      toggleSound() {
        this.soundEnabled = !this.soundEnabled;
        const soundBtn = document.getElementById('sound-toggle');
        
        if (this.soundEnabled) {
          soundBtn.textContent = 'üîä';
          soundBtn.classList.remove('muted');
        } else {
          soundBtn.textContent = 'üîá';
          soundBtn.classList.add('muted');
        }
      }

      playSound(type) {
        if (!this.soundEnabled) return;
        
        // Create audio context for simple beep sounds
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        switch(type) {
          case 'price_up':
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            break;
          case 'price_down':
            oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
            break;
          case 'trade':
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
            break;
          case 'success':
            oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
            break;
          case 'error':
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            break;
        }
        
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      }

      // Calculate investment amount
      switchTab(tabName) {
        // Update tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        
        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(`${tabName}-tab`).classList.add('active');
        
        // Update orders if needed
        if (tabName === 'orders') {
          this.updateOrdersDisplay();
        }
      }
      
      setPercentage(percentage) {
        const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
        const amountInput = document.getElementById(`${activeTab}-amount`);
        const priceInput = document.getElementById(`${activeTab}-price`);
        
        // Remove active class from all percentage buttons
        document.querySelectorAll('.percentage-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        
        // Add active class to clicked button
        event.target.classList.add('active');
        
        if (activeTab === 'buy') {
          // Calculate amount based on percentage of available balance
          const balance = this.currentUser.balance;
          const price = parseFloat(priceInput.value) || this.currentPrice;
          const maxAmount = Math.floor((balance * (percentage / 100)) / price);
          amountInput.value = maxAmount;
        } else if (activeTab === 'sell') {
          // Calculate amount based on percentage of BRETT holdings
          const holdings = this.currentUser.brettHoldings || 0;
          const maxAmount = Math.floor(holdings * (percentage / 100));
          amountInput.value = maxAmount;
        }
        
        this.calculateInvestment(activeTab);
      }
      
      calculateInvestment(type) {
        const amount = parseFloat(document.getElementById(`${type}-amount`).value) || 0;
        const price = parseFloat(document.getElementById(`${type}-price`).value) || 0;
        const totalInvestment = amount * price;
        
        document.getElementById(`${type}-investment-amount`).textContent = `$${totalInvestment.toFixed(2)}`;
      }
      
      updateOrdersDisplay() {
        // Update stop loss orders
        const stopLossContainer = document.getElementById('stop-loss-orders');
        stopLossContainer.innerHTML = '';
        
        if (this.currentUser.stopLosses && this.currentUser.stopLosses.length > 0) {
          this.currentUser.stopLosses.forEach((stopLoss, index) => {
            const orderItem = document.createElement('div');
            orderItem.className = 'order-item';
            orderItem.innerHTML = `
              <div class="order-info">
                <div class="order-type stop-loss">üõë Stop Loss</div>
                <div class="order-details">
                  ${stopLoss.amount.toLocaleString()} BRETT @ $${stopLoss.price.toFixed(6)}
                </div>
              </div>
              <button class="cancel-order-btn" onclick="window.tradingSimulator.cancelOrder('stopLoss', ${index})">
                Cancel
              </button>
            `;
            stopLossContainer.appendChild(orderItem);
          });
        } else {
          stopLossContainer.innerHTML = '<p style="color: #888; text-align: center;">No stop loss orders</p>';
        }
        
        // Update limit orders
        const limitOrdersContainer = document.getElementById('limit-orders');
        limitOrdersContainer.innerHTML = '';
        
        if (this.currentUser.limitOrders && this.currentUser.limitOrders.length > 0) {
          this.currentUser.limitOrders.forEach((order, index) => {
            const orderItem = document.createElement('div');
            orderItem.className = 'order-item';
            orderItem.innerHTML = `
              <div class="order-info">
                <div class="order-type ${order.type === 'buy' ? 'limit-buy' : 'limit-sell'}">
                  ${order.type === 'buy' ? 'üìâ' : 'üìà'} Limit ${order.type.toUpperCase()}
                </div>
                <div class="order-details">
                  ${order.amount.toLocaleString()} BRETT @ $${order.price.toFixed(6)}
                </div>
              </div>
              <button class="cancel-order-btn" onclick="window.tradingSimulator.cancelOrder('limit', ${index})">
                Cancel
              </button>
            `;
            limitOrdersContainer.appendChild(orderItem);
          });
        } else {
          limitOrdersContainer.innerHTML = '<p style="color: #888; text-align: center;">No limit orders</p>';
        }
      }
      
      cancelOrder(type, index) {
        if (type === 'stopLoss') {
          this.currentUser.stopLosses.splice(index, 1);
        } else if (type === 'limit') {
          this.currentUser.limitOrders.splice(index, 1);
        }
        
        this.updateUserData();
        this.updateOrdersDisplay();
        this.showNotification('Order cancelled successfully');
      }

      // Whale status methods
      checkWhaleStatus() {
        const isWhaleNow = this.currentUser.balance >= 100000;
        const whaleStatusElement = document.getElementById('whale-status');
        const permanentXBtn = document.getElementById('permanent-x-btn');
        
        if (isWhaleNow && !this.isWhale) {
          // Just became a whale
          this.isWhale = true;
          whaleStatusElement.style.display = 'inline-block';
          permanentXBtn.style.display = 'inline-block';
          this.showWhaleAnnouncement();
          this.playSound('success');
        } else if (!isWhaleNow && this.isWhale) {
          // Lost whale status
          this.isWhale = false;
          whaleStatusElement.style.display = 'none';
          permanentXBtn.style.display = 'none';
        } else if (isWhaleNow) {
          // Already a whale, just show status
          whaleStatusElement.style.display = 'inline-block';
          permanentXBtn.style.display = 'inline-block';
        }
      }

      showWhaleAnnouncement() {
        // Create whale medal
        const whaleMedal = document.createElement('div');
        whaleMedal.className = 'whale-medal';
        whaleMedal.innerHTML = 'üêã';
        document.body.appendChild(whaleMedal);
        
        // Create announcement with X posting option
        const announcement = document.createElement('div');
        announcement.className = 'whale-announcement';
        announcement.innerHTML = `
          üêã WHALE STATUS ACHIEVED! üêã<br>
          ${this.currentUser.username.toUpperCase()} IS NOW A BRETT WHALE!<br>
          BALANCE: $${this.currentUser.balance.toLocaleString()}<br>
          üéÆ FEATURED IN GAMES SECTION! üéÆ<br><br>
          <button id="post-to-x-btn" class="post-to-x-btn" onclick="window.tradingSimulator.postToX()">
            üêã POST TO X (TWITTER) üêã
          </button>
        `;
        document.body.appendChild(announcement);
        
        // Remove elements after animation (but keep X button accessible)
        setTimeout(() => {
          if (whaleMedal.parentNode) {
            whaleMedal.parentNode.removeChild(whaleMedal);
          }
          // Don't remove announcement immediately to allow X posting
        }, 4000);
        
        // Remove announcement after X posting or after longer delay
        setTimeout(() => {
          if (announcement.parentNode) {
            announcement.parentNode.removeChild(announcement);
          }
        }, 15000);
      }

      // Date functionality
      startDateUpdates() {
        setInterval(() => {
          this.currentDate.setDate(this.currentDate.getDate() + 1);
          this.updateDateDisplay();
        }, 30000); // Advance date every 30 seconds
      }

      updateDateDisplay() {
        const dateElement = document.getElementById('date-display');
        const options = { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        };
        dateElement.textContent = `üìÖ ${this.currentDate.toLocaleDateString('en-US', options)}`;
      }

      // Fast Forward functionality
      triggerFastForward(timeFrame) {
        if (this.fastForwardCooldown) return;
        
        this.fastForwardCooldown = true;
        
        // Disable all fast forward buttons
        document.querySelectorAll('.fast-forward-btn').forEach(btn => {
          btn.disabled = true;
          btn.textContent = '‚è≥ PROCESSING...';
        });
        
        // Advance time based on selected timeframe
        switch(timeFrame) {
          case '1week':
            this.currentDate.setDate(this.currentDate.getDate() + 7);
            break;
          case '2weeks':
            this.currentDate.setDate(this.currentDate.getDate() + 14);
            break;
          case '1month':
            this.currentDate.setMonth(this.currentDate.getMonth() + 1);
            break;
          case '2months':
            this.currentDate.setMonth(this.currentDate.getMonth() + 2);
            break;
          case '3months':
            this.currentDate.setMonth(this.currentDate.getMonth() + 3);
            break;
        }
        
        this.updateDateDisplay();
        
        // Trigger event based on timeframe and user
        setTimeout(() => {
          this.triggerRandomEvent(timeFrame);
        }, 1000);
      }

      triggerRandomEvent(timeFrame) {
        let events = [];
        
        // Different events based on timeframe
        switch(timeFrame) {
          case '1week':
            events = [
              {
                icon: 'üì±',
                title: 'SOCIAL MEDIA BUZZ',
                description: 'Brett meme gains traction on Twitter! Small community growth detected!',
                impact: 'bullish',
                priceChange: 0.1 + Math.random() * 0.2 // +10% to +30%
              },
              {
                icon: 'üìä',
                title: 'MINOR PRICE MOVEMENT',
                description: 'Normal market volatility causes small price fluctuation!',
                impact: 'neutral',
                priceChange: (Math.random() - 0.5) * 0.1 // ¬±5%
              },
              {
                icon: 'üí∏',
                title: 'SMALL SELL-OFF',
                description: 'Minor profit taking causes slight price dip!',
                impact: 'bearish',
                priceChange: -(0.05 + Math.random() * 0.1) // -5% to -15%
              },
              {
                icon: 'üêã',
                title: 'WHALE DUMP ALERT',
                description: 'Large holder starts selling! Price pressure increases!',
                impact: 'bearish',
                priceChange: -(0.2 + Math.random() * 0.3) // -20% to -50%
              },
              {
                icon: 'üò∞',
                title: 'FUD SPREADS',
                description: 'Negative rumours about Brett circulate!',
                impact: 'bearish',
                priceChange: -(0.15 + Math.random() * 0.25) // -15% to -40%
              },
              {
                icon: 'üíß',
                title: 'LIQUIDITY CRISIS',
                description: 'Low trading volume causes price instability!',
                impact: 'bearish',
                priceChange: -(0.25 + Math.random() * 0.35) // -25% to -60%
              }
            ];
            break;
            
          case '2weeks':
            events = [
              {
                icon: 'üéâ',
                title: 'COMMUNITY MILESTONE',
                description: 'Brett holders reach 100k! Community celebrates the achievement!',
                impact: 'bullish',
                priceChange: 0.2 + Math.random() * 0.3 // +20% to +50%
              },
              {
                icon: 'üìà',
                title: 'STEADY GROWTH',
                description: 'Consistent buying pressure leads to gradual price increase!',
                impact: 'bullish',
                priceChange: 0.15 + Math.random() * 0.25 // +15% to +40%
              },
              {
                icon: 'üìâ',
                title: 'MARKET CORRECTION',
                description: 'General market downturn affects Brett price!',
                impact: 'bearish',
                priceChange: -(0.1 + Math.random() * 0.2) // -10% to -30%
              },
              {
                icon: 'üò±',
                title: 'MAJOR SELL-OFF',
                description: 'Panic selling begins! Multiple holders exit!',
                impact: 'bearish',
                priceChange: -(0.3 + Math.random() * 0.4) // -30% to -70%
              },
              {
                icon: '‚ö°',
                title: 'FLASH CRASH',
                description: 'Sudden price plummet! Automated selling triggers!',
                impact: 'bearish',
                priceChange: -(0.4 + Math.random() * 0.5) // -40% to -90%
              },
              {
                icon: 'üêãüí®',
                title: 'WHALE EXODUS',
                description: 'Multiple whales exit simultaneously!',
                impact: 'bearish',
                priceChange: -(0.35 + Math.random() * 0.45) // -35% to -80%
              }
            ];
            break;
            
          case '1month':
            events = [
              {
                icon: 'üöÄ',
                title: 'BREAKING: BRETT LISTED ON MAJOR EXCHANGE',
                description: 'Brett token gets listed on a top-tier exchange! Trading volume explodes!',
                impact: 'bullish',
                priceChange: 2 + Math.random() * 3 // +200% to +500%
              },
              {
                icon: 'üíé',
                title: 'WHALE ACCUMULATION',
                description: 'Large investors start accumulating Brett! Institutional interest grows!',
                impact: 'bullish',
                priceChange: 1.5 + Math.random() * 2.5 // +150% to +400%
              },
              {
                icon: 'üêã',
                title: 'WHALE DUMP DETECTED',
                description: 'Large holder sells massive amount! Panic selling ensues!',
                impact: 'bearish',
                priceChange: -(0.3 + Math.random() * 0.4) // -30% to -70%
              },
              {
                icon: '‚ùÑÔ∏è',
                title: 'MARKET CRASH',
                description: 'Crypto winter hits hard! All tokens plummet!',
                impact: 'bearish',
                priceChange: -(0.5 + Math.random() * 0.6) // -50% to -110%
              },
              {
                icon: 'üö´',
                title: 'EXCHANGE DELISTING',
                description: 'Major exchange removes Brett! Trading halts!',
                impact: 'bearish',
                priceChange: -(0.6 + Math.random() * 0.7) // -60% to -130%
              },
              {
                icon: 'üí•',
                title: 'TEAM DRAMA',
                description: 'Internal conflicts surface! Community loses trust!',
                impact: 'bearish',
                priceChange: -(0.4 + Math.random() * 0.5) // -40% to -90%
              },
              {
                icon: 'üè¶',
                title: 'SMART MONEY EXIT',
                description: 'Institutional investors flee! Professional traders exit!',
                impact: 'bearish',
                priceChange: -(0.45 + Math.random() * 0.55) // -45% to -100%
              }
            ];
            break;
            
          case '2months':
            events = [
              {
                icon: 'üåü',
                title: 'BRETT GOES VIRAL',
                description: 'Brett meme becomes internet sensation! Millions of new holders join!',
                impact: 'bullish',
                priceChange: 3 + Math.random() * 4 // +300% to +700%
              },
              {
                icon: 'üéØ',
                title: 'MAJOR PARTNERSHIP ANNOUNCED',
                description: 'Brett partners with major brand! Mainstream adoption begins!',
                impact: 'bullish',
                priceChange: 2.5 + Math.random() * 3.5 // +250% to +600%
              },
              {
                icon: 'üí•',
                title: 'MARKET CRASH',
                description: 'Major market correction! Crypto winter hits hard!',
                impact: 'bearish',
                priceChange: -(0.4 + Math.random() * 0.6) // -40% to -100%
              },
              {
                icon: 'üíÄ',
                title: 'COMPLETE COLLAPSE',
                description: 'Brett loses 90% of its value! Total market destruction!',
                impact: 'bearish',
                priceChange: -(0.7 + Math.random() * 0.8) // -70% to -150%
              },
              {
                icon: 'üèÉ',
                title: 'RUG PULL FEARS',
                description: 'Community loses trust! Mass exodus begins!',
                impact: 'bearish',
                priceChange: -(0.6 + Math.random() * 0.7) // -60% to -130%
              },
              {
                icon: 'üåç',
                title: 'ECONOMIC CRISIS',
                description: 'Global recession impacts crypto! All assets crash!',
                impact: 'bearish',
                priceChange: -(0.5 + Math.random() * 0.6) // -50% to -110%
              },
              {
                icon: '‚ò¢Ô∏è',
                title: 'NUCLEAR SELL-OFF',
                description: 'Massive dumping begins! No buyers in sight!',
                impact: 'bearish',
                priceChange: -(0.8 + Math.random() * 0.9) // -80% to -170%
              }
            ];
            break;
            
          case '3months':
            events = [
              {
                icon: 'üöÄ',
                title: 'BRETT TO THE MOON!',
                description: 'Major partnership announced! Brett becomes the official meme token of a Fortune 500 company!',
                impact: 'bullish',
                priceChange: 5 + Math.random() * 10 // +500% to +1500%
              },
              {
                icon: 'üíé',
                title: 'DIAMOND HANDS REWARDED',
                description: 'Whale accumulation detected! Large institutional investors are buying BRETT in massive quantities!',
                impact: 'bullish',
                priceChange: 3 + Math.random() * 7 // +300% to +1000%
              },
              {
                icon: '‚ö°',
                title: 'FLASH CRASH',
                description: 'Sudden technical glitch causes automated selling! Price plummets in seconds!',
                impact: 'bearish',
                priceChange: -(0.4 + Math.random() * 0.6) // -40% to -100%
              },
              {
                icon: 'üî¥',
                title: 'REGULATORY FUD',
                description: 'New regulations threaten meme tokens! Uncertainty causes massive sell-off!',
                impact: 'bearish',
                priceChange: -(0.2 + Math.random() * 0.3) // -20% to -50%
              },
              {
                icon: '‚ò†Ô∏è',
                title: 'TOTAL DESTRUCTION',
                description: 'Brett goes to zero! Complete market wipeout!',
                impact: 'bearish',
                priceChange: -(0.9 + Math.random() * 0.95) // -90% to -185%
              },
              {
                icon: '‚ò¢Ô∏è',
                title: 'NUCLEAR WINTER',
                description: 'Crypto apocalypse! All meme coins destroyed!',
                impact: 'bearish',
                priceChange: -(0.85 + Math.random() * 0.9) // -85% to -175%
              },
              {
                icon: 'ü¶ñ',
                title: 'EXTINCTION EVENT',
                description: 'Meme coins wiped out! Brett becomes extinct!',
                impact: 'bearish',
                priceChange: -(0.8 + Math.random() * 0.85) // -80% to -165%
              },
              {
                icon: 'ü¶¢',
                title: 'BLACK SWAN',
                description: 'Unprecedented market crash! No one saw it coming!',
                impact: 'bearish',
                priceChange: -(0.95 + Math.random() * 0.98) // -95% to -193%
              }
            ];
            break;
        }
        
        // Add user-specific events with higher probability
        const username = this.currentUser.username;
        const userSpecificEvents = [
          {
            icon: 'üë§',
            title: `${username.toUpperCase()} MAKES HEADLINES!`,
            description: `${username} becomes a Brett trading legend! Their strategy goes viral!`,
            impact: 'bullish',
            priceChange: 0.5 + Math.random() * 1 // +50% to +150%
          },
          {
            icon: 'üéØ',
            title: `${username.toUpperCase()} PREDICTION COMES TRUE!`,
            description: `${username} called the market perfectly! Community follows their lead!`,
            impact: 'bullish',
            priceChange: 0.3 + Math.random() * 0.7 // +30% to +100%
          },
          {
            icon: 'üíé',
            title: `${username.toUpperCase()} DIAMOND HANDS!`,
            description: `${username} holds through the dip and gets rewarded!`,
            impact: 'bullish',
            priceChange: 0.2 + Math.random() * 0.5 // +20% to +70%
          }
        ];
        
        // 30% chance for user-specific event
        let finalEvents = events;
        if (Math.random() < 0.3) {
          finalEvents = [...events, ...userSpecificEvents];
        }
        
        const event = finalEvents[Math.floor(Math.random() * finalEvents.length)];
        this.showEventModal(event);
      }

      showEventModal(event) {
        const modal = document.getElementById('event-modal');
        modal.innerHTML = `
          <div class="event-content">
            <div class="event-icon">${event.icon}</div>
            <div class="event-title">${event.title}</div>
            <div class="event-description">${event.description}</div>
            <div class="event-impact ${event.impact}">
              <strong>Price Impact:</strong> ${event.priceChange > 0 ? '+' : ''}${(event.priceChange * 100).toFixed(0)}%
            </div>
            <button class="continue-btn" onclick="this.closest('.event-modal').style.display='none'; window.tradingSimulator.applyEventImpact(${event.priceChange});">
              CONTINUE TO SEE RESULTS
            </button>
          </div>
        `;
        modal.style.display = 'flex';
      }

      applyEventImpact(priceChange) {
        // Apply dramatic price change
        this.currentPrice *= (1 + priceChange);
        this.currentPrice = Math.max(0.000001, this.currentPrice);
        
        // Add visual effects
        const priceElement = document.getElementById('current-price');
        if (priceChange > 0) {
          priceElement.classList.add('price-moon');
          setTimeout(() => priceElement.classList.remove('price-moon'), 3000);
        } else {
          priceElement.classList.add('price-crash');
          setTimeout(() => priceElement.classList.remove('price-crash'), 3000);
        }
        
        // Update everything
        this.updatePriceDisplay();
        this.updateChartData();
        this.updateUI();
        this.updateLeaderboard();
        
        // Reset all fast forward buttons
        setTimeout(() => {
          this.fastForwardCooldown = false;
          document.querySelectorAll('.fast-forward-btn').forEach(btn => {
            btn.disabled = false;
            const timeFrame = btn.getAttribute('data-time');
            switch(timeFrame) {
              case '1week': btn.textContent = '‚è© 1 WEEK'; break;
              case '2weeks': btn.textContent = '‚è© 2 WEEKS'; break;
              case '1month': btn.textContent = '‚è© 1 MONTH'; break;
              case '2months': btn.textContent = '‚è© 2 MONTHS'; break;
              case '3months': btn.textContent = '‚è© 3 MONTHS'; break;
            }
          });
        }, 10000); // 10 second cooldown
      }

      // Change chart timeframe
      changeTimeframe(timeframe) {
        // Update active timeframe button
        document.querySelectorAll('.timeframe-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        document.querySelector(`[data-timeframe="${timeframe}"]`).classList.add('active');
        
        // Update chart display based on timeframe
        this.currentTimeframe = timeframe;
        this.updateChart();
        
        // Show notification
        this.showNotification(`Chart updated to ${timeframe.toUpperCase()} timeframe!`, 'info');
      }

      updateLeaderboard() {
        // Calculate profits for all users
        const usersWithProfits = this.users.map(user => {
          const brettHoldings = user.brettHoldings || 0;
          const totalValue = user.balance + (brettHoldings * this.currentPrice);
          const totalProfit = totalValue - 10000;
          const profitPercent = ((totalProfit / 10000) * 100);
          
          return {
            ...user,
            totalProfit,
            profitPercent,
            totalTrades: (user.trades || []).length
          };
        });
        
        // Sort by profit percentage
        usersWithProfits.sort((a, b) => b.profitPercent - a.profitPercent);
        
        // Update leaderboard
        const leaderboardBody = document.getElementById('leaderboard-body');
        leaderboardBody.innerHTML = usersWithProfits.map((user, index) => {
          const isCurrentUser = user.id === this.currentUser.id;
          const rowClass = isCurrentUser ? 'current-user-row' : '';
          
          return `
            <tr class="${rowClass}">
              <td>#${index + 1}</td>
              <td>
                <div class="leaderboard-user">
                  <img src="assets/${user.profilePicture}" alt="${user.username}" class="leaderboard-avatar">
                  <span>${user.username}</span>
                </div>
              </td>
              <td class="${user.totalProfit >= 0 ? 'positive' : 'negative'}">
                ${user.totalProfit >= 0 ? '+' : ''}$${user.totalProfit.toFixed(2)}
              </td>
              <td class="${user.profitPercent >= 0 ? 'positive' : 'negative'}">
                ${user.profitPercent >= 0 ? '+' : ''}${user.profitPercent.toFixed(1)}%
              </td>
              <td>${user.totalTrades}</td>
            </tr>
          `;
        }).join('');
      }
      
      loadAchievements() {
        const username = this.currentUser.username;
        const achievements = [
          { id: 'first-trade', name: 'First Trade', desc: 'Complete your first trade', icon: 'üéØ', unlocked: false },
          { id: 'profit-maker', name: 'Profit Maker', desc: 'Make your first profit', icon: 'üí∞', unlocked: false },
          { id: 'big-spender', name: 'Big Spender', desc: 'Spend over $1000 in one trade', icon: 'üí∏', unlocked: false },
          { id: 'frequent-trader', name: 'Frequent Trader', desc: 'Complete 10 trades', icon: 'üìà', unlocked: false },
          { id: 'brett-whale', name: 'Brett Whale', desc: 'Hold over 100,000 BRETT', icon: 'üê≥', unlocked: false },
          { id: 'top-trader', name: 'Top Trader', desc: 'Reach top 10 on leaderboard', icon: 'üèÜ', unlocked: false },
          { id: 'lucky-trader', name: `${username}'s Luck`, desc: 'Benefit from your unique luck factor', icon: 'üçÄ', unlocked: false },
          { id: 'volatile-trader', name: `${username}'s Volatility`, desc: 'Experience your unique market volatility', icon: '‚ö°', unlocked: false },
          { id: 'news-master', name: `${username}'s News Sense`, desc: 'Master your news preference', icon: 'üì∞', unlocked: false },
          { id: 'whale-status', name: 'üêã WHALE STATUS', desc: 'Reach $100,000+ balance', icon: 'üêã', unlocked: false },
          { id: 'crash-survivor', name: 'üíÄ Crash Survivor', desc: 'Survive a 50%+ price drop', icon: 'üíÄ', unlocked: false },
          { id: 'diamond-hands', name: 'üíé Diamond Hands', desc: 'Hold through a 70%+ crash', icon: 'üíé', unlocked: false },
          { id: 'apocalypse-survivor', name: '‚ò¢Ô∏è Apocalypse Survivor', desc: 'Survive a 90%+ market crash', icon: '‚ò¢Ô∏è', unlocked: false }
        ];
        
        const achievementsGrid = document.getElementById('achievements-grid');
        achievementsGrid.innerHTML = achievements.map(achievement => {
          const unlocked = this.checkAchievement(achievement.id);
          return `
            <div class="achievement-item ${unlocked ? 'unlocked' : ''}">
              <div class="achievement-icon">${achievement.icon}</div>
              <div class="achievement-name">${achievement.name}</div>
              <div class="achievement-desc">${achievement.desc}</div>
            </div>
          `;
        }).join('');
      }
      
      checkAchievement(achievementId) {
        const trades = this.currentUser.trades || [];
        const brettHoldings = this.currentUser.brettHoldings || 0;
        
        switch (achievementId) {
          case 'first-trade':
            return trades.length > 0;
          case 'profit-maker':
            return trades.some(trade => trade.profit > 0);
          case 'big-spender':
            return trades.some(trade => trade.total > 1000);
          case 'frequent-trader':
            return trades.length >= 10;
          case 'brett-whale':
            return brettHoldings >= 100000;
          case 'top-trader':
            // Check if user is in top 10
            const usersWithProfits = this.users.map(user => {
              const holdings = user.brettHoldings || 0;
              const totalValue = user.balance + (holdings * this.currentPrice);
              return totalValue - 10000;
            }).sort((a, b) => b - a);
            const userProfit = (this.currentUser.balance + (brettHoldings * this.currentPrice)) - 10000;
            return usersWithProfits.indexOf(userProfit) < 10;
          case 'lucky-trader':
            return Math.abs(this.userLuck) > 0.1; // Unlock if luck factor is significant
          case 'volatile-trader':
            return this.userVolatility > 1.2; // Unlock if volatility is high
          case 'news-master':
            return trades.length >= 5; // Unlock after some trading experience
          case 'whale-status':
            return this.currentUser.balance >= 100000; // Unlock when balance reaches $100k
          case 'crash-survivor':
            // Check if user survived a major crash (50%+ drop)
            return this.currentUser.balance > 5000 && this.currentUser.brettHoldings > 0;
          case 'diamond-hands':
            // Check if user held through extreme volatility
            return this.userVolatility > 1.5 && this.currentUser.brettHoldings > 0;
          case 'apocalypse-survivor':
            // Check if user survived multiple crashes
            return this.currentUser.balance > 10000 && this.currentUser.brettHoldings > 0;
          default:
            return false;
        }
      }
      
      checkAchievements() {
        // This would be called after each trade to check for new achievements
        this.loadAchievements();
      }
      
      postToX() {
        const username = this.currentUser.username;
        const balance = this.currentUser.balance.toLocaleString();
        const currentPrice = this.currentPrice.toFixed(6);
        const brettHoldings = (this.currentUser.brettHoldings || 0).toLocaleString();
        
        // Create the tweet content
        const tweetText = `üêã Just achieved WHALE status on Brett's Trading Simulator! üêã

üí∞ Balance: $${balance}
üéÆ BRETT Holdings: ${brettHoldings}
üìà Current Price: $${currentPrice}

üéØ Try it out here: https://brettonbonk.com/login

#Brett #BrettOnBonk #TradingSimulator #WhaleStatus #Crypto`;

        // Encode the tweet for URL
        const encodedTweet = encodeURIComponent(tweetText);
        
        // Open X (Twitter) in new tab
        const twitterUrl = `https://twitter.com/intent/tweet?text=${encodedTweet}`;
        window.open(twitterUrl, '_blank', 'width=600,height=400');
        
        // Mark as posted and show success message
        this.currentUser.hasPostedToX = true;
        this.updateUserData();
        this.showXPostSuccess();
        
        // Update button text to show it was posted
        const permanentXBtn = document.getElementById('permanent-x-btn');
        if (permanentXBtn) {
          permanentXBtn.textContent = '‚úÖ POSTED TO X';
          permanentXBtn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
          permanentXBtn.disabled = true;
          
          // Reset button after 30 seconds
          setTimeout(() => {
            permanentXBtn.textContent = 'üêã POST TO X';
            permanentXBtn.style.background = 'linear-gradient(45deg, #1DA1F2, #0D8BD9)';
            permanentXBtn.disabled = false;
          }, 30000);
        }
      }
      
      showXPostSuccess() {
        const successMsg = document.createElement('div');
        successMsg.className = 'x-post-success';
        successMsg.innerHTML = `
          ‚úÖ Posted to X (Twitter)! üêã<br>
          Share your whale status with the world!
        `;
        document.body.appendChild(successMsg);
        
        // Remove after 3 seconds
        setTimeout(() => {
          if (successMsg.parentNode) {
            successMsg.parentNode.removeChild(successMsg);
          }
        }, 3000);
      }
      
      logout() {
        localStorage.removeItem('brettTradingCurrentUser');
        window.location.href = '/login';
      }
      
      startTrading() {
        console.log('startTrading called');
        const introOverlay = document.getElementById('intro-overlay');
        const tradingPlatform = document.getElementById('trading-platform');
        if (!introOverlay || !tradingPlatform) {
          console.error('intro-overlay or trading-platform not found');
          showSimulatorError('Required elements missing.');
          return;
        }
        // ...rest of startTrading code...
      }
      
      checkStopLosses() {
        if (!this.currentUser.stopLosses) return;
        
        this.currentUser.stopLosses.forEach((stopLoss, index) => {
          if (this.currentPrice <= stopLoss.price) {
            // Execute stop loss
            const amount = stopLoss.amount;
            const totalValue = amount * this.currentPrice;
            
            this.currentUser.balance += totalValue;
            this.currentUser.brettHoldings -= amount;
            
            // Remove the stop loss
            this.currentUser.stopLosses.splice(index, 1);
            
            // Show notification
            this.showNotification(`üõë Stop Loss Executed: Sold ${amount.toLocaleString()} BRETT at $${this.currentPrice.toFixed(6)}`);
            this.playSound('trade');
          }
        });
      }
      
      checkLimitOrders() {
        if (!this.currentUser.limitOrders) return;
        
        this.currentUser.limitOrders.forEach((limitOrder, index) => {
          if (limitOrder.type === 'sell' && this.currentPrice >= limitOrder.price) {
            // Execute sell limit
            const amount = limitOrder.amount;
            const totalValue = amount * this.currentPrice;
            
            this.currentUser.balance += totalValue;
            this.currentUser.brettHoldings -= amount;
            
            // Remove the limit order
            this.currentUser.limitOrders.splice(index, 1);
            
            // Show notification
            this.showNotification(`üìà Limit Sell Executed: Sold ${amount.toLocaleString()} BRETT at $${this.currentPrice.toFixed(6)}`);
            this.playSound('trade');
          } else if (limitOrder.type === 'buy' && this.currentPrice <= limitOrder.price) {
            // Execute buy limit
            const amount = limitOrder.amount;
            const totalCost = amount * this.currentPrice;
            
            if (this.currentUser.balance >= totalCost) {
              this.currentUser.balance -= totalCost;
              this.currentUser.brettHoldings += amount;
              
              // Remove the limit order
              this.currentUser.limitOrders.splice(index, 1);
              
              // Show notification
              this.showNotification(`üìâ Limit Buy Executed: Bought ${amount.toLocaleString()} BRETT at $${this.currentPrice.toFixed(6)}`);
              this.playSound('trade');
            }
          }
        });
      }
      
      showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }
    }
    
    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOMContentLoaded fired');
      const startBtn = document.getElementById('start-trading-btn');
      if (!startBtn) {
        console.error('start-trading-btn not found');
        showSimulatorError('Start button not found.');
        return;
      }
      console.log('Attaching start button listener');
      startBtn.addEventListener('click', () => {
        console.log('Start button clicked');
        try {
          window.tradingSimulator = new TradingSimulator();
          console.log('TradingSimulator constructed');
          window.tradingSimulator.startTrading();
        } catch (e) {
          console.error('Error constructing TradingSimulator:', e);
          showSimulatorError(e.message);
        }
      });
    });

    // Tips Modal
    const tipsModal = document.createElement('div');
    tipsModal.className = 'tips-modal';
    tipsModal.style.display = 'none';
    tipsModal.innerHTML = `
      <div class="tips-content">
        <button class="close-tips" onclick="closeTips()">√ó</button>
        <h2 class="tips-title">üí° TRADING TIPS</h2>
        
        <div class="tip-item">
          <div class="tip-title">üìà Buy Low, Sell High</div>
          <div class="tip-text">Watch the price chart and news feed to identify the best entry and exit points. Green candlesticks mean price went up, red means it went down.</div>
        </div>
        
        <div class="tip-item">
          <div class="tip-title">üì∞ Read the News</div>
          <div class="tip-text">Market news affects BRETT price! Bullish news (green) usually means price will rise, bearish news (red) usually means price will fall.</div>
        </div>
        
        <div class="tip-item">
          <div class="tip-title">üí∞ Manage Risk</div>
          <div class="tip-text">Don't invest all your money at once. Start with small trades and learn from your mistakes. Diversify your portfolio!</div>
        </div>
        
        <div class="tip-item">
          <div class="tip-title">‚è∞ Be Patient</div>
          <div class="tip-text">Price updates every 2 seconds. Don't panic sell on small dips - wait for better opportunities.</div>
        </div>
        
        <div class="tip-item">
          <div class="tip-title">üéØ Set Targets</div>
          <div class="tip-text">Have a profit target in mind before you trade. Take profits when you reach your goals!</div>
        </div>
        
        <div class="tip-item">
          <div class="tip-title">üèÜ Compete</div>
          <div class="tip-text">Check the leaderboard to see how you rank against other traders. Unlock achievements to prove your skills!</div>
        </div>
      </div>
    `;
    document.body.appendChild(tipsModal);

    // Tips functions
    function showTips() {
      document.querySelector('.tips-modal').style.display = 'flex';
    }

    function closeTips() {
      document.querySelector('.tips-modal').style.display = 'none';
    }



    // Event Modal
    const eventModal = document.createElement('div');
    eventModal.className = 'event-modal';
    eventModal.style.display = 'none';
    eventModal.id = 'event-modal';
    document.body.appendChild(eventModal);

    // In TradingSimulator class, at the start of startTrading():
    console.log('startTrading called');
    const introOverlay = document.getElementById('intro-overlay');
    const tradingPlatform = document.getElementById('trading-platform');
    if (!introOverlay || !tradingPlatform) {
      console.error('intro-overlay or trading-platform not found');
      showSimulatorError('Required elements missing.');
      return;
    }
  </script>
</body>
</html> 